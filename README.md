

![](https://picreso.oss-cn-beijing.aliyuncs.com/blockchain.png)

<div align = "center">

# Baby-BlockChainğŸ‘¶

From baby to learn and build a Blockchain in JavağŸŒˆ

</div>

## å¤§çº²

+ ç†è®ºéƒ¨åˆ†

	1. å¿«é€Ÿç†è§£
	2. æ·±å…¥æŠ€æœ¯

> å¿«é€Ÿå­¦ä¹ åŒºå—é“¾ï¼Œç†è§£å’ŒæŒæ¡åŒºå—é“¾ç›¸å…³çŸ¥è¯†ã€‚

+ å®è·µéƒ¨åˆ†
  1. åŸºç¡€åŒºå—é“¾
  2. æ‰©å±•åŒºå—é“¾

> ç®€å•ç”¨Javaå®ç°ä¸€ä¸ªåŒºå—é“¾ã€‚

## ç†è®ºéƒ¨åˆ†

### å®šä¹‰

åŒºå—é“¾æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª**å»ä¸­å¿ƒåŒ–**çš„**åˆ†å¸ƒå¼è´¦æœ¬æ•°æ®åº“**ã€‚

å…¶æœ¬èº«æ˜¯ä¸€ä¸²ä½¿ç”¨å¯†ç å­¦ç›¸å…³è”æ‰€äº§ç”Ÿçš„æ•°æ®å—ï¼Œæ¯ä¸€ä¸ªæ•°æ®å—ä¸­åŒ…å«äº†å¤šæ¬¡æ¯”ç‰¹å¸ç½‘ç»œäº¤æ˜“æœ‰æ•ˆç¡®è®¤çš„ä¿¡æ¯ã€‚ 

è¿™æ˜¯åŒºå—é“¾çš„å®šä¹‰ï¼Œå› æ­¤è¦é€æ­¥äº†è§£åŒºå—é“¾ï¼Œæˆ‘ä»¬éœ€è¦ä¸€æ­¥æ­¥äº†è§£å¦‚ä¸‹ä¸œè¥¿ã€‚

### å¿«é€Ÿç†è§£

#### **å»ä¸­å¿ƒåŒ–**

å…ˆæ¥è€ƒè™‘ä¸€ä¸ªä¸­å¿ƒåŒ–é›†ä¸­å¼å¤„ç†çš„è¿‡ç¨‹ã€‚

ä½ è¦åœ¨æ·˜å®ä¸Šä¹°ä¸€éƒ¨æ‰‹æœºï¼Œäº¤æ˜“æµç¨‹æ˜¯ï¼š

ä½ å°†é’±æ‰“ç»™æ”¯ä»˜å®ï¼æ”¯ä»˜å®æ”¶æ¬¾åé€šçŸ¥å–å®¶å‘è´§ï¼å–å®¶å‘è´§ï¼ä½ ç¡®è®¤æ”¶è´§ï¼æ”¯ä»˜å®æŠŠé’±æ‰“ç»™å–å®¶ã€‚

![](https://picreso.oss-cn-beijing.aliyuncs.com/mayun.png)

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè™½ç„¶ä½ æ˜¯åœ¨å’Œå–å®¶äº¤æ˜“ï¼Œä½†æ˜¯è¿™ç¬”äº¤æ˜“è¿˜ç‰µæ‰¯åˆ°äº†é™¤äº†ä½ å’Œå–å®¶çš„ç¬¬ä¸‰æ–¹ï¼Œå³æ”¯ä»˜å®ï¼Œä½ å’Œå–å®¶çš„äº¤æ˜“éƒ½æ˜¯å›´ç»•æ”¯ä»˜å®å±•å¼€ã€‚

å› æ­¤ï¼Œå¦‚æœæ”¯ä»˜å®ç³»ç»Ÿå‡ºäº†é—®é¢˜ä¾¿ä¼šé€ æˆè¿™ç¬”äº¤æ˜“çš„å¤±è´¥ï¼Œå¹¶ä¸”è™½ç„¶ä½ åªæ˜¯ç®€å•çš„ä¹°äº†ä¸€ä¸ªæ‰‹æœºï¼Œä½†æ˜¯ä½ å’Œå–å®¶éƒ½è¦å‘ç¬¬ä¸‰æ–¹æä¾›å¤šä½™çš„ä¿¡æ¯ã€‚

å› æ­¤è€ƒè™‘æç«¯æƒ…å†µï¼Œå¦‚æœæ”¯ä»˜å®è·‘è·¯äº†æˆ–è€…æ˜¯æ‹¿äº†é’±ä¸å´ä¸æ‰¿è®¤ä½ çš„äº¤æ˜“æˆ–è€…æ˜¯æ”¯ä»˜å®æ‰€åœ¨çš„åŸå¸‚å› ä¸ºå¼€G20æŠŠæ‰€æœ‰äººéƒ½èµ¶èµ°äº†ï¼Œé‚£ä¹ˆä½ å°±æ‚²å‰§äº†ã€‚

è€Œå»ä¸­å¿ƒåŒ–çš„å¤„ç†æ–¹å¼å°±è¦æ˜¾å¾—ç®€å•å¾ˆå¤šï¼Œä½ åªéœ€è¦å’Œå–å®¶äº¤æ¢é’±å’Œæ‰‹æœºï¼Œç„¶ååŒæ–¹éƒ½å£°ç§°å®Œæˆäº†è¿™ç¬”äº¤æ˜“ï¼Œå°±OKäº†ã€‚

å¯ä»¥çœ‹å‡ºåœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œå»ä¸­å¿ƒåŒ–çš„å¤„ç†æ–¹å¼ä¼šæ›´ä¾¿æ·ï¼ŒåŒæ—¶ä¹Ÿæ— é¡»æ‹…å¿ƒè‡ªå·±çš„ä¸äº¤æ˜“æ— å…³çš„ä¿¡æ¯æ³„æ¼ã€‚

å…¶å®å¦‚æœåªè€ƒè™‘ä¸¤ä¸ªäººçš„äº¤æ˜“å¹¶ä¸èƒ½æŠŠå»ä¸­å¿ƒåŒ–çš„å¥½å¤„å®Œå…¨å±•ç¤ºå‡ºæ¥ï¼Œè®¾æƒ³å¦‚æœæœ‰æˆåƒä¸Šä¸‡ç¬”äº¤æ˜“åœ¨è¿›è¡Œï¼Œå»ä¸­å¿ƒåŒ–çš„å¤„ç†æ–¹å¼ä¼šèŠ‚çº¦å¾ˆå¤šèµ„æºï¼Œä½¿å¾—æ•´ä¸ªäº¤æ˜“è‡ªä¸»åŒ–ã€ç®€å•åŒ–ï¼Œå¹¶ä¸”æ’é™¤äº†è¢«ä¸­å¿ƒåŒ–ä»£ç†æ§åˆ¶çš„é£é™©ã€‚

å»ä¸­å¿ƒåŒ–æ˜¯åŒºå—é“¾æŠ€æœ¯çš„é¢ è¦†æ€§ç‰¹ç‚¹ï¼Œå®ƒæ— éœ€ä¸­å¿ƒåŒ–ä»£ç†ï¼Œå®ç°äº†ä¸€ç§ç‚¹å¯¹ç‚¹çš„ç›´æ¥äº¤äº’ï¼Œä½¿å¾—é«˜æ•ˆç‡ã€å¤§è§„æ¨¡ã€æ— ä¸­å¿ƒåŒ–ä»£ç†çš„ä¿¡æ¯äº¤äº’æ–¹å¼æˆä¸ºäº†ç°å®ã€‚

å½“ç„¶ï¼Œä¸Šè¿°çš„ä¾‹å­æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æ½œåœ¨é—®é¢˜ï¼šæ²¡æœ‰äº†æƒå¨çš„ä¸­å¿ƒåŒ–ä»£ç†ï¼Œæ€æ ·ä¿è¯æ¯ç¬”äº¤æ˜“çš„å‡†ç¡®æ€§å’Œæœ‰æ•ˆæ€§å‘¢ï¼Ÿæ¯”å¦‚ï¼šå¦‚æœæ²¡æœ‰äº†æƒå¨çš„ä¸­å¿ƒåŒ–ä»£ç†ï¼Œå¼ ä¸‰æŸä¸€å¤©å€Ÿäº†æˆ‘100å—é’±ï¼Œä½†æ˜¯ä¸è¿˜é’±è¿˜ä¸æ‰¿è®¤æ€ä¹ˆåŠï¼Ÿè¿™é‡Œå°±å¼•å‡ºäº†åŒºå—é“¾çš„å…¶å®ƒç‰¹æ€§ã€‚

#### **ä¸¤ä¸ªåŸºç¡€éš¾é¢˜**

åœ¨å»ä¸­å¿ƒåŒ–ä»¥åï¼Œæ•´ä¸ªç³»ç»Ÿä¸­æ²¡æœ‰äº†æƒå¨çš„ä¸­å¿ƒåŒ–ä»£ç†ï¼Œä¿¡æ¯çš„å¯ä¿¡åº¦å’Œå‡†ç¡®æ€§ä¾¿ä¼šé¢ä¸´é—®é¢˜ã€‚

#### é—®é¢˜1ï¼šç±»ä¸¤å†›é—®é¢˜

![](https://picreso.oss-cn-beijing.aliyuncs.com/tcp.png)

ç¬¬ä¸€æ¬¡å¬è¯´è¿™ä¸ªé—®é¢˜å±…ç„¶æ˜¯åœ¨TCPçš„è¯¾ä¸Šï¼Œå¤§è‡´è¯´çš„æ˜¯æœ‰ä¸¤ä¸ªç›¸è·å¾ˆè¿œçš„å†›é˜Ÿè¦ä¼ é€’ä¿¡æ¯ï¼Œçº¢å†›æ´¾é£ä¸€ä¸ªä¿¡ä½¿å»è·Ÿè“å†›è¯´ï¼šâ€œä½ ä»–å¨˜çš„æŠŠæ„å¤§åˆ©ç‚®æ‹¿å‡ºæ¥ï¼â€ã€‚è“å†›æ”¶åˆ°ä¿¡æ¯ååˆæ´¾äº†ä¸€ä¸ªä¿¡ä½¿å»çº¢å†›è¯´ï¼šâ€œæ”¶åˆ°æŒ‡ä»¤ï¼â€ã€‚ç„¶åçº¢å†›åˆæ´¾ä¸€ä¸ªä¿¡ä½¿å»è“å†›è¯´ï¼šâ€œçŸ¥é“ä½ æ”¶åˆ°æŒ‡ä»¤äº†ï¼â€ã€‚ç„¶åè“å†›åˆæ´¾ä¸€ä¸ªä¿¡ä½¿å»çº¢å†›è¯´ï¼šâ€œçŸ¥é“ä½ çŸ¥é“æˆ‘æ”¶åˆ°æŒ‡ä»¤äº†ï¼â€ã€‚ç„¶åçº¢å†›åˆæ´¾ä¸€ä¸ªä¿¡ä½¿å»è“å†›è¯´ï¼šâ€œçŸ¥é“ä½ çŸ¥é“æˆ‘çŸ¥é“ä½ æ”¶åˆ°æŒ‡ä»¤äº†ï¼â€â€¦â€¦ç„¶åå°±æ²¡å®Œæ²¡äº†äº†ã€‚

åœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­åœ¨å¼‚æ­¥ç³»ç»Ÿå’Œä¸å¯é çš„é€šé“ä¸Šè¾¾åˆ°ä¸€è‡´æ€§æ˜¯ä¸å¯èƒ½çš„åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸ºæ˜¯ç‚¹å¯¹ç‚¹çš„é€šä¿¡ï¼ŒåŒæ–¹ä¸å¯èƒ½åœ¨è¿™ç§æƒ…å†µä¸‹è¾¾åˆ°ä¿¡æ¯çš„ä¸€è‡´æ€§ã€‚ä¸¥è°¨ä¸€ç‚¹ï¼Œå°±æ˜¯â€œåœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸Šï¼Œè¯•å›¾åœ¨å¼‚æ­¥ç³»ç»Ÿå’Œä¸å¯é çš„é€šé“ä¸Šè¾¾åˆ°ä¸€è‡´æ€§æ˜¯ä¸å¯èƒ½çš„â€ã€‚



#### é—®é¢˜2ï¼šæ‹œå åº­å°†å†›é—®é¢˜

æ‹œå åº­ç½—é©¬å¸å›½åœ¨å†›äº‹è¡ŒåŠ¨ä¸­ï¼Œé‡‡å–å°†å†›æŠ•ç¥¨çš„ç­–ç•¥æ¥å†³å®šæ˜¯è¿›æ”»è¿˜æ˜¯æ’¤é€€ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå¤šæ•°äººå†³å®šè¿›æ”»ï¼Œå°±ä¸Šå»å¹²ã€‚ä½†æ˜¯å†›é˜Ÿä¸­å¦‚æœæœ‰å¥¸ç»†ï¼ˆæ¯”å¦‚å°†å†›å·²ç»åæ°´æ•…æ„ä¹±æŠ•ç¥¨ï¼Œæˆ–è€…ä¼ ä»¤å®˜å›å˜æ“…è‡ªä¿®æ”¹å†›ä»¤ï¼‰ï¼Œé‚£æ€ä¹ˆä¿è¯æœ€åæŠ•ç¥¨çš„ç»“æœçœŸæ­£åæ˜ äº†å¿ è¯šçš„å°†å†›çš„æ„æ„¿å‘¢ï¼Ÿ



æ‹œå åº­å°†å†›é—®é¢˜åæ˜ åˆ°ä¿¡æ¯äº¤æ¢é¢†åŸŸä¸­æ¥ï¼Œå¯ä»¥ç†è§£ä¸ºåœ¨ä¸€ä¸ªå»ä¸­å¿ƒçš„ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸€äº›èŠ‚ç‚¹æ˜¯åæ‰çš„ï¼Œå®ƒä»¬å¯èƒ½å‘å¤–ç•Œå¹¿æ’­é”™è¯¯çš„ä¿¡æ¯æˆ–è€…ä¸å¹¿æ’­ä¿¡æ¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å¦‚ä½•éªŒè¯æ•°æ®ä¼ è¾“çš„å‡†ç¡®æ€§ã€‚



#### **åŒºå—é“¾æŠ€æœ¯çš„è¯ç”Ÿ**

ç°åœ¨è®©æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥åœ¨å»ä¸­å¿ƒåŒ–çš„ç³»ç»Ÿä¸­è§£å†³è¿™äº›é—®é¢˜ï¼Œè§è¯åŒºå—é“¾æŠ€æœ¯é›å½¢çš„è¯ç”Ÿã€‚

æˆ‘ä»¬å…ˆæ¥å»ºç«‹ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ç³»ç»Ÿï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„å»ä¸­å¿ƒåŒ–å€Ÿè´·æ¨¡å‹ï¼š

å¦‚æœAå€Ÿäº†B 100å—é’±ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒAåœ¨äººç¾¤ä¸­å¤§å–Šâ€œæˆ‘æ˜¯Aï¼Œæˆ‘å€Ÿç»™äº†B 100å—é’±ï¼â€ï¼ŒBä¹Ÿåœ¨äººç¾¤ä¸­å¤§å–Šâ€œæˆ‘æ˜¯Bï¼ŒAå€Ÿç»™äº†æˆ‘100å—é’±ï¼â€ï¼Œæ­¤æ—¶è·¯äººç”²ä¹™ä¸™ä¸éƒ½å¬åˆ°äº†è¿™äº›æ¶ˆæ¯ï¼Œå› æ­¤æ‰€æœ‰äººéƒ½åœ¨å¿ƒä¸­é»˜é»˜è®°ä¸‹äº†â€œAå€Ÿç»™äº†B100å—é’±â€ã€‚

ä½ çœ‹ï¼Œè¿™ä¸ªæ—¶å€™ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„ç³»ç»Ÿå°±å»ºç«‹èµ·æ¥äº†ï¼Œè¿™ä¸ªç³»ç»Ÿä¸­ä¸éœ€è¦é“¶è¡Œï¼Œä¹Ÿä¸éœ€è¦å€Ÿè´·åè®®å’Œæ”¶æ®ï¼Œä¸¥æ ¼æ¥è¯´ï¼Œç”šè‡³ä¸éœ€è¦äººä¸äººé•¿ä¹…çš„ä¿¡ä»»å…³ç³»ï¼ˆæ¯”å¦‚Bçªç„¶åˆæ”¹å£è¯´â€œæˆ‘ä¸æ¬ Aé’±ï¼â€ï¼Œè¿™ä¸ªæ—¶å€™äººæ°‘ç¾¤ä¼—å°±ä¼šç«™å‡ºæ¥è¯´â€œä¸å¯¹ï¼Œæˆ‘çš„å°æœ¬æœ¬ä¸Šè®°å½•äº†ä½ æŸå¤©å€Ÿäº†A100å—é’±ï¼â€ï¼‰ã€‚

![](https://picreso.oss-cn-beijing.aliyuncs.com/money.png)



å¯èƒ½ä½ å·²ç»å‘ç°äº†ï¼Œåœ¨ä¸Šè¿°çš„æ¨¡å‹ä¸­ï¼Œæ‰€è°“çš„â€œ100å—é’±â€å·²ç»ä¸é‡è¦äº†ã€‚æ¢å¥è¯è¯´ï¼Œä»»ä½•ä¸œè¥¿éƒ½å¯ä»¥åœ¨è¿™ä¸ªæ¨¡å‹ä¸­äº¤æ¢ï¼Œç”šè‡³ä½ å¯ä»¥å‡­ç©ºæœæ’°ä¸€ä¸ªä¸œè¥¿ï¼Œåªè¦å¤§å®¶æ‰¿è®¤ï¼Œä½ å°±å¯ä»¥è®©ä½ æœæ’°çš„ä¸œè¥¿æµé€šã€‚æ¯”å¦‚ï¼šæˆ‘åœ¨äººç¾¤ä¸­é«˜å–Šä¸€å£°â€œæˆ‘åˆ›é€ äº†10ä¸ªæŸ¥å…‹æ‹‰ï¼â€ï¼Œæˆ‘ç”šè‡³ä¸éœ€è¦çŸ¥é“æŸ¥å…‹æ‹‰æ˜¯ä»€ä¹ˆï¼Œä¹Ÿä¸éœ€è¦å…³å¿ƒä¸–ç•Œä¸Šæ˜¯ä¸æ˜¯çœŸçš„æœ‰æŸ¥å…‹æ‹‰ï¼Œåªè¦å¤§å®¶éƒ½å¬åˆ°ï¼Œç„¶ååœ¨è‡ªå·±çš„å°æœ¬æœ¬ä¸Šè®°ä¸‹â€œLXZæœ‰10ä¸ªæŸ¥å…‹æ‹‰â€ï¼Œäºæ˜¯æˆ‘å°±çœŸçš„æœ‰100ä¸ªæŸ¥å…‹æ‹‰äº†ã€‚ä»æ­¤ä»¥åï¼Œæˆ‘ä¾¿å¯ä»¥å£°ç§°æˆ‘ç»™äº†æŸäºº1ä¸ªæŸ¥å…‹æ‹‰ï¼Œåªè¦è·¯äººç”²ä¹™ä¸™ä¸éƒ½æ”¶åˆ°å¹¶ä¸”æ‰¿è®¤äº†è¿™ä¸€ä¿¡æ¯ï¼Œé‚£æˆ‘å°±ç®—å®Œæˆäº†è¿™æ¬¡äº¤æ˜“ï¼Œå“ªæ€•ä¸–ç•Œä¸Šæ²¡æœ‰æŸ¥å…‹æ‹‰ã€‚



ä½ ç°åœ¨è„‘æµ·ä¸­æ˜¯ä¸æ˜¯æµ®ç°å‡ºäº†ä¸‰ä¸ªå­—â€”â€”â€œæ¯”ç‰¹å¸â€ï¼Ÿç”±äºçœŸæ­£çš„åŒºå—é“¾å’Œæ¯”ç‰¹å¸æ¯”æˆ‘ä¸Šè¿°çš„æ¨¡å‹å¤æ‚å¤ªå¤šï¼Œç»†èŠ‚ä¹Ÿä¸°å¯Œå¤ªå¤šï¼Œå› æ­¤ä»¥ä¸‹è¿˜æ˜¯ä»¥æŸ¥å…‹æ‹‰ä¸¾ä¾‹



å‡è®¾è¿‡äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å‡­ç©ºåˆ›é€ çš„æŸ¥å…‹æ‹‰å·²ç»åœ¨è¿™ä¸ªç³»ç»Ÿä¸­æµé€šäº†èµ·æ¥ï¼Œå¤§å®¶éƒ½å¼€å§‹è®¤å¯äº†æŸ¥å…‹æ‹‰ã€‚ä½†æ˜¯è¿™ä¸ªç³»ç»Ÿä¸­ä¸€å…±å°±åªæœ‰10ä¸ªæŸ¥å…‹æ‹‰ï¼Œäºæ˜¯æœ‰äººåŠ¨äº†åå¿ƒæ€ï¼Œä»–åœ¨äººç¾¤ä¸­é«˜å‘¼â€œæˆ‘æœ‰10ä¸ªæŸ¥å…‹æ‹‰ï¼â€æ€ä¹ˆåŠï¼Ÿå¤§å®¶æ˜¯ç›´æ¥åœ¨æœ¬æœ¬ä¸Šè®°ä¸‹ä»–æœ‰10ä¸ªæŸ¥å…‹æ‹‰ä¹ˆï¼Œè¿™æ ·ä¸æ˜¯äººäººéƒ½å¯ä»¥ä¼ªé€ æŸ¥å…‹æ‹‰äº†ä¹ˆï¼Ÿ



ä¸ºäº†é˜²æ­¢è¿™ç§ç°è±¡å‘ç”Ÿï¼Œæˆ‘å†³å®šåœ¨æˆ‘åˆ›é€ æŸ¥å…‹æ‹‰çš„æ—¶å€™ç»™æˆ‘çš„æŸ¥å…‹æ‹‰æ‰“ä¸Šæ ‡è®°ï¼ˆæ›´å‡†ç¡®åœ°è¯´ï¼Œæˆ‘æ˜¯ç»™æˆ‘å–Šçš„é‚£å¥â€œæˆ‘åˆ›é€ äº†10ä¸ªæŸ¥å…‹æ‹‰â€æ‰“ä¸Šæ ‡è®°ï¼Œæ¯”å¦‚æ ‡è®°ä¸º001ï¼‰ï¼Œè¿™æ ·ä»¥ååœ¨æ¯ä¸€ç¬”äº¤æ˜“çš„æ—¶å€™ï¼Œæˆ‘åœ¨é«˜å–Šâ€œæˆ‘ç»™äº†æŸæŸ1ä¸ªæŸ¥å…‹æ‹‰ï¼â€çš„æ—¶å€™ï¼Œä¼šé™„åŠ ä¸Šé¢å¤–çš„ä¸€å¥è¯ï¼šâ€œè¿™1ä¸ªæŸ¥å…‹æ‹‰çš„æ¥æºæ˜¯è®°ä¸º001çš„é‚£æ¡è®°å½•ï¼Œæˆ‘çš„è¿™å¥è¯æ ‡è®°ä¸º002ï¼â€ã€‚æˆ‘ä»¬å†æŠ½è±¡ä¸€ç‚¹ï¼ŒæŸäººå–Šè¯çš„å†…å®¹çš„æ ¼å¼å°±å˜æˆäº†ï¼šâ€œè¿™å¥è¯ç¼–å·xxxï¼Œä¸Šä¸€å¥è¯çš„ç¼–å·æ˜¯yyyï¼Œæˆ‘ç»™äº†æŸæŸ1ä¸ªæŸ¥å…‹æ‹‰ï¼â€ï¼Œè¿™æ ·å°±è§£å†³äº†ä¼ªé€ çš„é—®é¢˜ã€‚å…¶å®ä¸Šè¿°æ¨¡å‹å°±å˜æˆä¸€ä¸ªç®€åŒ–çš„ä¸­æœ¬èªç¬¬ä¸€ç‰ˆæ¯”ç‰¹å¸åŒºå—é“¾åè®®ï¼š

![](https://picreso.oss-cn-beijing.aliyuncs.com/model.png)

å¥½äº†ï¼Œçœ‹åˆ°è¿™é‡Œä½ åŸºæœ¬å·²ç»èƒ½å¤Ÿç”ŸåŠ¨å½¢è±¡åˆä¸æ¶‰åŠä»»ä½•ç»†èŠ‚åœ°å‘ä½ çš„å¼±æ™ºå®¤å‹è§£é‡ŠåŒºå—é“¾äº†



#### â€œå‡­å•¥ï¼Ÿâ€

ä½ å®¤å‹å¯èƒ½ä¼šé—®ï¼šâ€œå‡­å•¥ä½ å–Šä¸€å¥è¯æˆ‘å°±å¸®ä½ è®°ï¼Ÿæˆ‘çš„å°æœ¬æœ¬ä¸è¦é’±ä¹ˆï¼Ÿâ€ã€‚ä¸ºäº†æ¿€åŠ±å¤§å®¶å¸®æˆ‘ä¼ è¯å’Œè®°è´¦ï¼Œæˆ‘å†³å®šç»™ç¬¬ä¸€ä¸ªå¬åˆ°æˆ‘å–Šè¯å¹¶ä¸”è®°å½•åœ¨å°æœ¬æœ¬ä¸Šçš„äººä¸€äº›å¥–åŠ±ï¼šç¬¬ä¸€ä¸ªå¬åˆ°æˆ‘å–Šè¯å¹¶è®°å½•ä¸‹æ¥çš„äººï¼Œä½ å°±å‡­ç©ºå¾—åˆ°äº†1ä¸ªæŸ¥å…‹æ‹‰ï¼Œè¿™ä¸ªæŸ¥å…‹æ‹‰æ˜¯æ•´ä¸ªç³»ç»Ÿå¯¹ä½ å¹¸è‹¦è®°è´¦çš„æŠ¥é…¬ï¼Œè€Œä½ è®°å½•äº†è¿™å¥è¯ä¹‹åï¼Œè¦é©¬ä¸Šå‘Šè¯‰å…¶å®ƒäººä½ å·²ç»è®°å½•å¥½äº†ï¼Œè®©åˆ«äººæ”¾å¼ƒç»§ç»­è®°å½•è¿™å¥è¯ï¼Œå¹¶ç»™ä½ è‡ªå·±çš„è®°å½•ç¼–å·è®©åˆ«äººæœ‰æ®å¯æŸ¥ï¼Œç„¶åä½ å†æŠŠæˆ‘çš„è¯åŠ ä¸Šä½ çš„è®°å½•ç¼–å·ä¸€èµ·å–Šå‡ºæ¥ï¼Œä¾›ä¸‹ä¸€ä¸ªäººè®°è´¦ã€‚

å½“è¿™ä¸ªè§„åˆ™å®šä¸‹ä»¥åï¼Œè¿™ä¸ªç³»ç»Ÿä¸­ä¸€å®šä¼šå‡ºç°ä¸€æ‰¹äººï¼Œä»–ä»¬å¼€å§‹ç«–ç€è€³æœµç›‘å¬å‘¨å›´å‘å‡ºçš„å£°éŸ³ï¼Œä»¥æŠ¢å ç¬¬ä¸€ä¸ªè®°è´¦çš„æƒåˆ©ã€‚å¯¹çš„ï¼Œä½ è„‘æµ·ä¸­æ˜¯ä¸æ˜¯åˆæµ®ç°å‡ºäº†â€œæ¯”ç‰¹å¸æŒ–çŸ¿â€çš„å­—çœ¼ï¼Ÿ

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå…³äºæ¯”ç‰¹å¸æŒ–çŸ¿

å•èº«æ±ªä»¬è¦æ‰¾å¥³ç¥¨ï¼Œå›½æ°‘å²³æ¯è¯´æˆ‘æœ‰å¥½å¤šå¥³å„¿ï¼Œè¿™æ ·å§æˆ‘ç»™ä½ ä»¬å‡ºç‚¹é¢˜ç›®ï¼Œè§£å‡ºä¸€ä¸ªå°±ç»™å…¶ä¸­ä¸€ä¸ªå§‘å¨˜çš„å¾®ä¿¡å·ã€‚

å•èº«æ±ªä»¬ç–¯ç‹‚ç«äº‰ï¼Œæƒ³ç ´è„‘è¢‹å»è§£é¢˜ã€‚åªè¦å…¶ä¸­ä¸€åªæ±ªè§£å‡ºä¸€é“é¢˜ï¼Œå°±ç«‹é©¬å¾—æ„æ´‹æ´‹åœ°æ˜­å‘Šå¤©ä¸‹ï¼Œç¤ºå¨å…¨éƒ¨å•èº«æ±ªï¼Œè¿™ä¸ªå§‘å¨˜æ˜¯æˆ‘çš„å•¦ï¼Œä½ ä»¬æ”¾å¼ƒå§ã€‚å…¶ä»–å•èº«æ±ªä»¬å³ä½¿ä¸æœä¹Ÿæ²¡æœ‰åŠæ³•ï¼Œæƒ†æ€…æ‡Šæ¼ä¹Ÿä¸æ˜¯ä¸ªäº‹å„¿å•Šï¼Œè¿˜æ˜¯éº»æºœåœ°ç«‹é©¬å»è§£ä¸‹ä¸€é“é¢˜ç›®å§ã€‚è¿™åªå–œèµ¢å§‘å¨˜çš„å¹¸è¿å°æ±ªè¢«å²³æ¯è®¤å¯åè¿˜èƒ½å¾—åˆ°25ä¸ªè´§å¸å•ä½çš„å½©ç¤¼ï¼Œç®€ç›´äººç”Ÿèµ¢å®¶ã€‚

#### â€œå¬è°çš„ï¼Ÿâ€

åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œå¦‚æœæˆ‘å’Œå¦ä¸€ä¸ªäººCå‡ ä¹åŒæ—¶åœ°å–Šå‡ºä¸€å¥ï¼šâ€œä¸ºäº†è‰¾æ³½æ‹‰æ–¯ï¼â€ã€‚ç”±äºå¬ä¼—æ‰€å¤„çš„ä½ç½®ä¸åŒï¼Œä¸€å®šä¼šæœ‰äººå…ˆå¬åˆ°æˆ‘è¯´çš„é‚£å¥è¯ï¼Œè€Œå¦å¤–ä¸€äº›äººåˆ™å…ˆå¬åˆ°Cçš„é‚£å¥è¯ï¼Œå¦‚æœæˆ‘ä»¬è§„å®šåªèƒ½æœ‰ä¸€ä¸ªäººè¯´å‡ºè¿™å¥è¯ï¼Œé‚£åˆ°åº•è¿™å¥è¯æ˜¯è°è¯´çš„ï¼Ÿ

å¦‚æœä¸åŠ ä»»ä½•æ¡ä»¶ï¼Œé‚£ä¹ˆä¸Šè¿°çš„æƒ…å†µä¸€å®šä¼šè¿™æ ·å‘å±•ï¼šä¸€éƒ¨åˆ†äººè®¤ä¸ºè¿™å¥è¯æ˜¯æˆ‘è¯´çš„ï¼Œåœ¨å¬åˆ°è¿™å¥è¯ä¹‹åå¼€å§‹è®°è´¦ï¼Œä¹‹åä»–ä»¬æ‰€åšçš„æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯åŸºäºè¿™ä¸ªäº‹å®ï¼Œå¹¶ä¸”éšç€è¿™ä¸ªä¿¡æ¯ä¸€æ¬¡æ¬¡çš„ä¼ ä¸‹å»ï¼Œè¿™æ¡ä¿¡æ¯é“¾ä¼šè¶Šæ¥è¶Šæ·±ï¼›è€Œå¦å¤–ä¸€ç¾¤è®¤ä¸ºæ˜¯Cå…ˆè¯´è¿™å¥è¯çš„äººï¼Œä¹Ÿä¼šæŒ‰ç…§è¿™æ ·çš„è¶‹åŠ¿å‘å±•ã€‚è¿™æ ·ï¼ŒåŸæœ¬æ˜¯ä¸€æ¡å”¯ä¸€çš„ä¿¡æ¯é“¾ï¼Œåœ¨æˆ‘ä»¬å–Šå‡ºâ€œä¸ºäº†è‰¾æ³½æ‹‰æ–¯â€è¿™å¥è¯ä¹‹åï¼Œåˆ†å‰äº†ï¼ï¼Ÿ

![](https://picreso.oss-cn-beijing.aliyuncs.com/2way.png)

è¿™ä¼šå¯¼è‡´æ€æ ·çš„æƒ…å†µå‘¢ï¼ŸæŒ‰ç…§æˆ‘ä»¬çš„è®¾æƒ³ï¼Œåº”è¯¥æ¯ä¸ªäººçš„å°æœ¬æœ¬ä¸Šè®°å½•çš„ä¸œè¥¿éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä¸€æ¡å¯ä»¥æŠŠæ‰€æœ‰ä¿¡æ¯ä¸²è”èµ·æ¥çš„é“¾æ¡ã€‚ä½†æ˜¯åœ¨è¿™ä¸€åˆ»ï¼Œä»–ä»¬å°æœ¬æœ¬ä¸Šè®°å½•çš„ä¸œè¥¿ä¸ä¸€æ ·äº†ï¼è¿™è¿˜ç©æ¯›å•Šï¼Ÿä»¥åè¿˜æ€ä¹ˆç¡®å®šäº¤æ˜“å’Œä¿¡æ¯çš„çœŸå®æ€§ï¼ï¼Ÿ

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘åˆè¿½åŠ äº†æ–°çš„è§„åˆ™ï¼šæ¯ä¸ªäººåœ¨è®°å½•å°æœ¬æœ¬çš„æ—¶å€™ï¼Œéœ€è¦è„±é‹ç„¶åç”¨è„šæ‹¿ç¬”ï¼Œåœ¨å°æœ¬æœ¬ä¸Šç”¨æ­£æ¥·ä½“ä¹¦å†™ï¼æœ‰äº†è¿™ä¸ªè§„å®šï¼Œç”±äºç”¨è„šå†™å­—éš¾åº¦å¾ˆå¤§ï¼Œæ¯ä¸ªäººè‡³å°‘éœ€è¦10åˆ†é’Ÿæ‰èƒ½å†™å®Œï¼Œè€Œä¸”ç”±äºæ¯ä¸ªäººç”¨è„šå†™å­—çš„ç†Ÿç»ƒåº¦ä¸é€šï¼Œå†™å®Œè¿™å¥è¯æ‰€ç”¨çš„æ—¶é—´ä¹Ÿä¸åŒï¼Œå› æ­¤ä¸€å®šä¼šæœ‰äººå…ˆå†™å®Œç„¶åé«˜å‘¼â€œæˆ‘å†™å®Œäº†ï¼é‚£å¥è¯æ˜¯XXXå–Šçš„ï¼â€ï¼Œè¿™æ ·å…¶å®ƒæ­£åœ¨å†™è¿™å¥è¯çš„äººä¾¿ä¼šåœç¬”ï¼Œç„¶ååœ¨å°æœ¬æœ¬ä¸Šé‡æ–°å¼€å§‹å†™â€œé‚£å¥è¯æ˜¯æ¥æ–‡å†™çš„ï¼Œä¸Šä¸€å¥çš„ç¼–å·æ˜¯xxxâ€ã€‚

å¦‚æœä½ å¯¹ä¸Šè¿°æˆ‘çš„è§£å†³æ–¹æ³•æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥å¯¹ç…§æˆ‘ä¸Šé¢çš„æ¯”å–»å»äº†è§£ä»¥ä¸‹çŸ¥è¯†ï¼š

â€œå¬è°çš„â€â€”â€”ä¸­æœ¬èªç ´è§£â€œæ‹œå åº­å°†å†›é—®é¢˜â€çš„ç®—æ³•

â€œåœ¨å°æœ¬æœ¬ä¸Šè®°å½•â€â€”â€”æ¯”ç‰¹å¸æŒ–çŸ¿

â€œè„±é‹ç”¨è„šå†™å­—â€â€”â€”æ¯”ç‰¹å¸æŒ–çŸ¿éš¾åº¦

â€œè„±é‹å†™å­—é€Ÿåº¦â€â€”â€”ç®—åŠ›

â€œæ–°çš„è§„åˆ™â€â€”â€”å·¥ä½œé‡è¯æ˜é“¾



## å®è·µéƒ¨åˆ†

> åŒºå—é“¾æ˜¯åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ã€ç‚¹å¯¹ç‚¹ä¼ è¾“ã€å…±è¯†æœºåˆ¶ã€åŠ å¯†ç®—æ³•ç­‰è®¡ç®—æœºæŠ€æœ¯çš„æ–°å‹åº”ç”¨æ¨¡å¼ã€‚æ‰€è°“å…±è¯†æœºåˆ¶æ˜¯åŒºå—é“¾ç³»ç»Ÿä¸­å®ç°ä¸åŒèŠ‚ç‚¹ä¹‹é—´å»ºç«‹ä¿¡ä»»ã€è·å–æƒç›Šçš„æ•°å­¦ç®—æ³• ã€‚

æœ¬ç³»åˆ—æ•™ç¨‹æ—¨åœ¨å¸®åŠ©ä½ äº†è§£å¦‚ä½•å¼€å‘åŒºå—é“¾æŠ€æœ¯ã€‚

**æœ¬ç« ç›®æ ‡**

- åˆ›å»ºä½ ç¬¬ä¸€ä¸ªéå¸¸åŸºæœ¬çš„åŒºå—é“¾
- å®ç°ä¸€ä¸ªç®€å•çš„å·¥ä½œé‡è¯æ˜ç³»ç»Ÿå³æŒ–çŸ¿
- åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•

ï¼ˆæˆ‘ä¼šå‡è®¾ä½ å¯¹é¢å‘å¯¹è±¡ç¼–ç¨‹æœ‰åŸºæœ¬çš„äº†è§£ï¼‰

*å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œåˆ›å»ºçš„åŒºå—é“¾å¹¶ä¸æ˜¯åŠŸèƒ½å®Œå…¨çš„å®Œå…¨é€‚åˆåº”ç”¨ä¸ç”Ÿäº§çš„åŒºå—é“¾ï¼Œç›¸ååªæ˜¯ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½çš„ç†è§£åŒºå—é“¾çš„æ¦‚å¿µã€‚*

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.gif)

### åˆ›å»ºåŒºå—é“¾

åŒºå—é“¾å°±æ˜¯ä¸€ä¸²æˆ–è€…æ˜¯ä¸€ç³»åˆ—åŒºå—çš„é›†åˆï¼Œç±»ä¼¼äºé“¾è¡¨çš„æ¦‚å¿µï¼Œæ¯ä¸ªåŒºå—éƒ½æŒ‡å‘äºåé¢ä¸€ä¸ªåŒºå—ï¼Œç„¶åé¡ºåºçš„è¿æ¥åœ¨ä¸€èµ·ã€‚é‚£ä¹ˆæ¯ä¸ªåŒºå—ä¸­çš„å†…å®¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨åŒºå—é“¾ä¸­çš„æ¯ä¸€ä¸ªåŒºå—éƒ½å­˜æ”¾äº†å¾ˆå¤šå¾ˆæœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œä¸»è¦åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼šè‡ªå·±çš„æ•°å­—ç­¾åï¼Œä¸Šä¸€ä¸ªåŒºå—çš„æ•°å­—ç­¾åï¼Œè¿˜æœ‰ä¸€åˆ‡éœ€è¦åŠ å¯†çš„æ•°æ®ï¼ˆè¿™äº›æ•°æ®åœ¨æ¯”ç‰¹å¸ä¸­å°±ç›¸å½“äºæ˜¯äº¤æ˜“çš„ä¿¡æ¯ï¼Œå®ƒæ˜¯åŠ å¯†è´§å¸çš„æœ¬è´¨ï¼‰ã€‚æ¯ä¸ªæ•°å­—ç­¾åä¸ä½†è¯æ˜äº†è‡ªå·±æ˜¯ç‰¹æœ‰çš„ä¸€ä¸ªåŒºå—ï¼Œè€Œä¸”æŒ‡å‘äº†å‰ä¸€ä¸ªåŒºå—çš„æ¥æºï¼Œè®©æ‰€æœ‰çš„åŒºå—åœ¨é“¾æ¡ä¸­å¯ä»¥ä¸²èµ·æ¥ï¼Œè€Œæ•°æ®å°±æ˜¯ä¸€äº›ç‰¹å®šçš„ä¿¡æ¯ï¼Œä½ å¯ä»¥æŒ‰ç…§ä¸šåŠ¡é€»è¾‘æ¥ä¿å­˜ä¸šåŠ¡æ•°æ®ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai01.png)

**è¿™é‡Œçš„hashæŒ‡çš„å°±æ˜¯æ•°å­—ç­¾å**

**æ‰€ä»¥æ¯ä¸€ä¸ªåŒºå—ä¸ä»…åŒ…å«å‰ä¸€ä¸ªåŒºå—çš„hashå€¼ï¼ŒåŒæ—¶åŒ…å«è‡ªèº«çš„ä¸€ä¸ªhashå€¼**ï¼Œè‡ªèº«çš„`hash`å€¼æ˜¯é€šè¿‡ä¹‹å‰çš„`hash`å€¼å’Œæ•°æ®`data`é€šè¿‡`hash`è®¡ç®—å‡ºæ¥çš„ã€‚å¦‚æœå‰ä¸€ä¸ªåŒºå—çš„æ•°æ®ä¸€æ—¦è¢«ç¯¡æ”¹äº†ï¼Œé‚£ä¹ˆå‰ä¸€ä¸ªåŒºå—çš„hashå€¼ä¹Ÿä¼šåŒæ ·å‘ç”Ÿå˜åŒ–ï¼ˆå› ä¸ºæ•°æ®ä¹Ÿè¢«è®¡ç®—åœ¨å†…ï¼‰ï¼Œè¿™æ ·ä¹Ÿå°±å¯¼è‡´äº†æ‰€æœ‰åç»­çš„åŒºå—ä¸­çš„`hash`å€¼ã€‚**æ‰€ä»¥è®¡ç®—å’Œæ¯”å¯¹hashå€¼ä¼šè®©æˆ‘ä»¬æ£€æŸ¥åˆ°å½“å‰çš„åŒºå—é“¾æ˜¯å¦æ˜¯æœ‰æ•ˆçš„**ï¼Œä¹Ÿå°±é¿å…äº†æ•°æ®è¢«æ¶æ„ç¯¡æ”¹çš„å¯èƒ½æ€§ï¼Œå› ä¸ºç¯¡æ”¹æ•°æ®å°±ä¼šæ”¹å˜hashå€¼å¹¶ç ´åæ•´ä¸ªåŒºå—é“¾ã€‚

#### å®šä¹‰åŒºå—é“¾çš„ç±»å¿«

```java
import java.util.Date;

public class Block {

	public String hash;
	public String previousHash;
	private String data; //our data will be a simple message.
	private long timeStamp; //as number of milliseconds since 1/1/1970.

	//Block Constructor.
	public Block(String data,String previousHash ) {
		this.data = data;
		this.previousHash = previousHash;
		this.timeStamp = new Date().getTime();
	}
}
```

æ­£å¦‚ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„åŸºæœ¬å—åŒ…å«`String hash`ï¼Œå®ƒå°†ä¿å­˜æˆ‘ä»¬çš„æ•°å­—ç­¾åã€‚å˜é‡`previoushash`ä¿å­˜å‰ä¸€ä¸ªå—çš„`hash`å’Œ`String data`æ¥ä¿å­˜æˆ‘ä»¬çš„å—æ•°æ®

#### åˆ›å»ºæ•°å­—ç­¾å

ç†Ÿæ‚‰åŠ å¯†ç®—æ³•çš„æœ‹å‹ä»¬ï¼ŒJavaæ–¹å¼å¯ä»¥å®ç°çš„åŠ å¯†æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚BASEã€MDã€RSAã€SHAç­‰ç­‰ï¼Œæˆ‘åœ¨è¿™é‡Œé€‰ç”¨äº†`SHA256`è¿™ç§åŠ å¯†æ–¹å¼ï¼ŒSHAï¼ˆSecure Hash Algorithmï¼‰å®‰å…¨æ•£åˆ—ç®—æ³•ï¼Œè¿™ç§ç®—æ³•çš„ç‰¹ç‚¹æ˜¯æ•°æ®çš„å°‘é‡æ›´æ”¹ä¼šåœ¨Hashå€¼ä¸­äº§ç”Ÿä¸å¯é¢„çŸ¥çš„å¤§é‡æ›´æ”¹ï¼Œhashå€¼ç”¨ä½œè¡¨ç¤ºå¤§é‡æ•°æ®çš„å›ºå®šå¤§å°çš„å”¯ä¸€å€¼ï¼Œè€ŒSHA256ç®—æ³•çš„hashå€¼å¤§å°ä¸º256ä½ã€‚ä¹‹æ‰€ä»¥é€‰ç”¨SHA256æ˜¯å› ä¸ºå®ƒçš„å¤§å°æ­£åˆé€‚ï¼Œä¸€æ–¹é¢äº§ç”Ÿé‡å¤hashå€¼çš„å¯èƒ½æ€§å¾ˆå°ï¼Œå¦ä¸€æ–¹é¢åœ¨åŒºå—é“¾å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„åŒºå—ï¼Œè€Œä½¿å¾—ä¿¡æ¯é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆ256ä½çš„å¤§å°å°±æ¯”è¾ƒæ°å½“äº†ã€‚

ä¸‹é¢æˆ‘åˆ›å»ºäº†ä¸€ä¸ª`StringUtil`æ–¹æ³•æ¥æ–¹ä¾¿è°ƒç”¨SHA256ç®—æ³•

```java
import java.security.MessageDigest;

public class StringUtil {
	//Applies Sha256 to a string and returns the result. 
	public static String applySha256(String input){		
		try {
			MessageDigest digest = MessageDigest.getInstance("SHA-256");	        
			//Applies sha256 to our input, 
			byte[] hash = digest.digest(input.getBytes("UTF-8"));	        
			StringBuffer hexString = new StringBuffer(); // This will contain hash as hexidecimal
			for (int i = 0; i < hash.length; i++) {
				String hex = Integer.toHexString(0xff & hash[i]);
				if(hex.length() == 1) hexString.append('0');
				hexString.append(hex);
			}
			return hexString.toString();
		}
		catch(Exception e) {
			throw new RuntimeException(e);
		}
	}	
}
```

æˆ–è®¸ä½ å®Œå…¨ä¸ç†è§£ä¸Šè¿°ä»£ç çš„å«ä¹‰ï¼Œä½†æ˜¯ä½ åªè¦ç†è§£æ‰€æœ‰çš„è¾“å…¥è°ƒç”¨æ­¤æ–¹æ³•åå‡ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„hashå€¼ï¼ˆæ•°å­—ç­¾åï¼‰ï¼Œè€Œè¿™ä¸ªhashå€¼åœ¨åŒºå—é“¾ä¸­æ˜¯éå¸¸é‡è¦çš„ã€‚

æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨`Block`ç±»ä¸­åº”ç”¨ æ–¹æ³• applySha256 æ–¹æ³•ï¼Œå…¶ä¸»è¦çš„ç›®çš„å°±æ˜¯è®¡ç®—hashå€¼ï¼Œæˆ‘ä»¬è®¡ç®—çš„hashå€¼åº”è¯¥åŒ…æ‹¬åŒºå—ä¸­æ‰€æœ‰æˆ‘ä»¬ä¸å¸Œæœ›è¢«æ¶æ„ç¯¡æ”¹çš„æ•°æ®ï¼Œåœ¨æˆ‘ä»¬ä¸Šé¢æ‰€åˆ—çš„`Block`ç±»ä¸­å°±ä¸€å®šåŒ…æ‹¬`previousHash`ï¼Œ`data`å’Œ`timeStamp`ï¼Œ

```java
public String calculateHash() {
	String calculatedhash = StringUtil.applySha256( 
			previousHash +
			Long.toString(timeStamp) +
			data 
			);
	return calculatedhash;
}
```

ç„¶åæŠŠè¿™ä¸ªæ–¹æ³•åŠ å…¥åˆ°`Block`çš„æ„é€ å‡½æ•°ä¸­å»

```java
public Block(String data,String previousHash ) {
		this.data = data;
		this.previousHash = previousHash;
		this.timeStamp = new Date().getTime();
		this.hash = calculateHash(); //Making sure we do this after we set the other values.
	}
```

#### æµ‹è¯•

åœ¨ä¸»æ–¹æ³•ä¸­è®©æˆ‘ä»¬åˆ›å»ºä¸€äº›åŒºå—ï¼Œå¹¶æŠŠå…¶hashå€¼æ‰“å°å‡ºæ¥ï¼Œæ¥çœ‹çœ‹æ˜¯å¦ä¸€åˆ‡éƒ½åœ¨æˆ‘ä»¬çš„æŒæ§ä¸­ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai.gif)

ç¬¬ä¸€ä¸ªå—ç§°ä¸ºåˆ›ä¸–çºªåŒºå—ï¼Œå› ä¸ºå®ƒæ˜¯å¤´åŒºå—ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¾“å…¥â€œ0â€ä½œä¸ºå‰ä¸€ä¸ªå—çš„`previous hash`ã€‚

```java
public class NoobChain {

	public static void main(String[] args) {
		
		Block genesisBlock = new Block("Hi im the first block", "0");
		System.out.println("Hash for block 1 : " + genesisBlock.hash);
		
		Block secondBlock = new Block("Yo im the second block",genesisBlock.hash);
		System.out.println("Hash for block 2 : " + secondBlock.hash);
		
		Block thirdBlock = new Block("Hey im the third block",secondBlock.hash);
		System.out.println("Hash for block 3 : " + thirdBlock.hash);
		
	}
}
```

æ‰“å°ï¼š

```java
Hash for block 1: f6d1bc5f7b0016eab53ec022db9a5d9e1873ee78513b1c666696e66777fe55fb
Hash for block 2: 6936612b3380660840f22ee6cb8b72ffc01dbca5369f305b92018321d883f4a3
Hash for block 3: f3e58f74b5adbd59a7a1fc68c97055d42e94d33f6c322d87b29ab20d3c959b8f
```

æ¯ä¸€ä¸ªåŒºå—éƒ½å¿…é¡»è¦æœ‰è‡ªå·±çš„æ•°æ®ç­¾åå³hashå€¼ï¼Œè¿™ä¸ªhashå€¼ä¾èµ–äºè‡ªèº«çš„ä¿¡æ¯ï¼ˆdataï¼‰å’Œä¸Šä¸€ä¸ªåŒºå—çš„æ•°å­—ç­¾åï¼ˆpreviousHashï¼‰ï¼Œä½†è¿™ä¸ªè¿˜ä¸æ˜¯åŒºå—é“¾ï¼Œä¸‹é¢è®©æˆ‘ä»¬å­˜å‚¨åŒºå—åˆ°æ•°ç»„ä¸­ï¼Œè¿™é‡Œæˆ‘ä¼šå¼•å…¥gsonåŒ…ï¼Œç›®çš„æ˜¯å¯ä»¥ç”¨jsonæ–¹å¼æŸ¥çœ‹æ•´ä¸ªä¸€æ¡åŒºå—é“¾ç»“æ„ã€‚

```java
import java.util.ArrayList;
import com.google.gson.GsonBuilder;

public class NoobChain {
	
	public static ArrayList<Block> blockchain = new ArrayList<Block>(); 

	public static void main(String[] args) {	
		//add our blocks to the blockchain ArrayList:
		blockchain.add(new Block("Hi im the first block", "0"));		
		blockchain.add(new Block("Yo im the second block",blockchain.get(blockchain.size()-1).hash)); 
		blockchain.add(new Block("Hey im the third block",blockchain.get(blockchain.size()-1).hash));
		
		String blockchainJson = new GsonBuilder().setPrettyPrinting().create().toJson(blockchain);		
		System.out.println(blockchainJson);
	}

}
```

è¿™æ ·çš„è¾“å‡ºç»“æ„å°±æ›´ç±»ä¼¼äºæˆ‘ä»¬æ‰€æœŸå¾…çš„åŒºå—é“¾çš„æ ·å­ã€‚

#### æ£€æŸ¥åŒºå—é“¾çš„å®Œæ•´æ€§

åœ¨ä¸»æ–¹æ³•ä¸­å¢åŠ ä¸€ä¸ªisChainValid()æ–¹æ³•ï¼Œç›®çš„æ˜¯å¾ªç¯åŒºå—é“¾ä¸­çš„æ‰€æœ‰åŒºå—å¹¶ä¸”æ¯”è¾ƒhashå€¼ï¼Œè¿™ä¸ªæ–¹æ³•ç”¨æ¥æ£€æŸ¥hashå€¼æ˜¯å¦æ˜¯äºè®¡ç®—å‡ºæ¥çš„hashå€¼ç›¸ç­‰ï¼ŒåŒæ—¶previousHashå€¼æ˜¯å¦å’Œå‰ä¸€ä¸ªåŒºå—çš„hashå€¼ç›¸ç­‰ã€‚æˆ–è®¸ä½ ä¼šäº§ç”Ÿå¦‚ä¸‹çš„ç–‘é—®ï¼Œæˆ‘ä»¬å°±åœ¨ä¸€ä¸ªä¸»å‡½æ•°ä¸­åˆ›å»ºåŒºå—é“¾ä¸­çš„åŒºå—ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è¢«ä¿®æ”¹çš„å¯èƒ½æ€§ï¼Œä½†æ˜¯ä½ è¦æ³¨æ„çš„æ˜¯ï¼ŒåŒºå—é“¾ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µå°±æ˜¯å»ä¸­å¿ƒåŒ–ï¼Œæ¯ä¸€ä¸ªåŒºå—å¯èƒ½æ˜¯åœ¨ç½‘ç»œä¸­çš„æŸä¸€ä¸ªèŠ‚ç‚¹ä¸­äº§ç”Ÿçš„ï¼Œæ‰€ä»¥å¾ˆæœ‰å¯èƒ½æŸä¸ªèŠ‚ç‚¹æŠŠè‡ªå·±èŠ‚ç‚¹ä¸­çš„æ•°æ®ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæ ¹æ®ä¸Šè¿°çš„ç†è®ºæ•°æ®æ”¹å˜ä¼šå¯¼è‡´æ•´ä¸ªåŒºå—é“¾çš„ç ´è£‚ï¼Œä¹Ÿå°±æ˜¯åŒºå—é“¾å°±æ— æ•ˆäº†ã€‚

```java
public static Boolean isChainValid() {
	Block currentBlock; 
	Block previousBlock;
	
	//loop through blockchain to check hashes:
	for(int i=1; i < blockchain.size(); i++) {
		currentBlock = blockchain.get(i);
		previousBlock = blockchain.get(i-1);
		//compare registered hash and calculated hash:
		if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){
			System.out.println("Current Hashes not equal");			
			return false;
		}
		//compare previous hash and registered previous hash
		if(!previousBlock.hash.equals(currentBlock.previousHash) ) {
			System.out.println("Previous Hashes not equal");
			return false;
		}
	}
	return true;
}
```

ä»»ä½•åŒºå—é“¾ä¸­åŒºå—çš„ä¸€ä¸ä¸€æ¯«æ”¹å˜éƒ½ä¼šå¯¼è‡´è¿™ä¸ªå‡½æ•°è¿”å›falseï¼Œä¹Ÿå°±è¯æ˜äº†åŒºå—é“¾æ— æ•ˆäº†ã€‚

åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­æ‰€æœ‰çš„ç½‘ç»œèŠ‚ç‚¹éƒ½åˆ†äº«äº†å®ƒä»¬å„è‡ªçš„åŒºå—é“¾ï¼Œç„¶è€Œæœ€é•¿çš„æœ‰æ•ˆåŒºå—é“¾æ˜¯è¢«å…¨ç½‘æ‰€ç»Ÿä¸€æ‰¿è®¤çš„ï¼Œå¦‚æœæœ‰äººæ¶æ„æ¥ç¯¡æ”¹ä¹‹å‰çš„æ•°æ®ï¼Œç„¶ååˆ›å»ºä¸€æ¡æ›´é•¿çš„åŒºå—é“¾å¹¶å…¨ç½‘å‘å¸ƒå‘ˆç°åœ¨ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™å°±æ¶‰åŠåˆ°äº†åŒºå—é“¾ä¸­å¦å¤–ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µå·¥ä½œé‡è¯æ˜ï¼Œè¿™é‡Œå°±ä¸å¾—ä¸æåŠä¸€ä¸‹hashcashï¼Œè¿™ä¸ªæ¦‚å¿µæœ€æ—©æ¥è‡ªäºAdam Backçš„ä¸€ç¯‡è®ºæ–‡ï¼Œä¸»è¦åº”ç”¨äºé‚®ä»¶è¿‡æ»¤å’Œæ¯”ç‰¹å¸ä¸­é˜²æ­¢åŒé‡æ”¯ä»˜ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.gif)

### æŒ–çŸ¿

è¿™é‡Œæˆ‘ä»¬è¦æ±‚æŒ–çŸ¿è€…åšå·¥ä½œé‡è¯æ˜ï¼Œå…·ä½“çš„æ–¹å¼æ˜¯åœ¨åŒºå—ä¸­å°è¯•ä¸åŒçš„å‚æ•°å€¼ç›´åˆ°å®ƒçš„hashå€¼æ˜¯ä»ä¸€ç³»åˆ—çš„0å¼€å§‹çš„ã€‚è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåä¸º`nonce`çš„intç±»å‹ä»¥åŒ…å«åœ¨æˆ‘ä»¬çš„`calculatehashï¼ˆï¼‰`æ–¹æ³•ä¸­ï¼Œä»¥åŠéœ€è¦çš„`mineblockï¼ˆï¼‰`æ–¹æ³•

```java
import java.util.Date;

public class Block {
	
	public String hash;
	public String previousHash; 
	private String data; //our data will be a simple message.
	private long timeStamp; //as number of milliseconds since 1/1/1970.
	private int nonce;
	
	//Block Constructor.  
	public Block(String data,String previousHash ) {
		this.data = data;
		this.previousHash = previousHash;
		this.timeStamp = new Date().getTime();
		
		this.hash = calculateHash(); //Making sure we do this after we set the other values.
	}
	
	//Calculate new hash based on blocks contents
	public String calculateHash() {
		String calculatedhash = StringUtil.applySha256( 
				previousHash +
				Long.toString(timeStamp) +
				Integer.toString(nonce) + 
				data 
				);
		return calculatedhash;
	}
	
	public void mineBlock(int difficulty) {
		String target = new String(new char[difficulty]).replace('\0', '0'); //Create a string with difficulty * "0" 
		while(!hash.substring( 0, difficulty).equals(target)) {
			nonce ++;
			hash = calculateHash();
		}
		System.out.println("Block Mined!!! : " + hash);
	}
}
```

mineBlock()æ–¹æ³•ä¸­å¼•å…¥äº†ä¸€ä¸ªintå€¼ç§°ä¸ºdifficultyéš¾åº¦ï¼Œä½çš„éš¾åº¦æ¯”å¦‚1å’Œ2ï¼Œæ™®é€šçš„ç”µè„‘åŸºæœ¬éƒ½å¯ä»¥é©¬ä¸Šè®¡ç®—å‡ºæ¥ï¼Œæˆ‘çš„å»ºè®®æ˜¯åœ¨4-6ä¹‹é—´è¿›è¡Œæµ‹è¯•ï¼Œæ™®é€šç”µè„‘å¤§æ¦‚ä¼šèŠ±è´¹3ç§’æ—¶é—´ï¼Œåœ¨è±ç‰¹å¸ä¸­éš¾åº¦å¤§æ¦‚å›´ç»•åœ¨442592å·¦å³ï¼Œè€Œåœ¨æ¯”ç‰¹å¸ä¸­æ¯ä¸€æ¬¡æŒ–çŸ¿éƒ½è¦æ±‚å¤§æ¦‚åœ¨10åˆ†é’Ÿå·¦å³ï¼Œå½“ç„¶æ ¹æ®æ‰€æœ‰ç½‘ç»œä¸­çš„è®¡ç®—èƒ½åŠ›ï¼Œéš¾åº¦ä¹Ÿä¼šä¸æ–­çš„è¿›è¡Œä¿®æ”¹ã€‚

æˆ‘ä»¬åœ¨`NoobChain`ç±» ä¸­å¢åŠ `difficulty`è¿™ä¸ªé™æ€å˜é‡ã€‚

```java
public static int difficulty = 5;
```

è¿™æ ·æˆ‘ä»¬å¿…é¡»ä¿®æ”¹ä¸»æ–¹æ³•ä¸­è®©åˆ›å»ºæ¯ä¸ªæ–°åŒºå—æ—¶å¿…é¡»è§¦å‘`mineBlock()`æ–¹æ³•ï¼Œè€Œ`isChainValid()`æ–¹æ³•ç”¨æ¥æ£€æŸ¥æ¯ä¸ªåŒºå—çš„hashå€¼æ˜¯å¦æ­£ç¡®ï¼Œæ•´ä¸ªåŒºå—é“¾æ˜¯å¦æ˜¯æœ‰æ•ˆçš„ã€‚

```java
import java.util.ArrayList;
import com.google.gson.GsonBuilder;

public class NoobChain {
	
	public static ArrayList<Block> blockchain = new ArrayList<Block>();
	public static int difficulty = 5;

	public static void main(String[] args) {	
		//add our blocks to the blockchain ArrayList:
		
		blockchain.add(new Block("Hi im the first block", "0"));
		System.out.println("Trying to Mine block 1... ");
		blockchain.get(0).mineBlock(difficulty);
		
		blockchain.add(new Block("Yo im the second block",blockchain.get(blockchain.size()-1).hash));
		System.out.println("Trying to Mine block 2... ");
		blockchain.get(1).mineBlock(difficulty);
		
		blockchain.add(new Block("Hey im the third block",blockchain.get(blockchain.size()-1).hash));
		System.out.println("Trying to Mine block 3... ");
		blockchain.get(2).mineBlock(difficulty);	
		
		System.out.println("\nBlockchain is Valid: " + isChainValid());
		
		String blockchainJson = new GsonBuilder().setPrettyPrinting().create().toJson(blockchain);
		System.out.println("\nThe block chain: ");
		System.out.println(blockchainJson);
	}
	
	public static Boolean isChainValid() {
		Block currentBlock; 
		Block previousBlock;
		String hashTarget = new String(new char[difficulty]).replace('\0', '0');
		
		//loop through blockchain to check hashes:
		for(int i=1; i < blockchain.size(); i++) {
			currentBlock = blockchain.get(i);
			previousBlock = blockchain.get(i-1);
			//compare registered hash and calculated hash:
			if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){
				System.out.println("Current Hashes not equal");			
				return false;
			}
			//compare previous hash and registered previous hash
			if(!previousBlock.hash.equals(currentBlock.previousHash) ) {
				System.out.println("Previous Hashes not equal");
				return false;
			}
			//check if hash is solved
			if(!currentBlock.hash.substring( 0, difficulty).equals(hashTarget)) {
				System.out.println("This block hasn't been mined");
				return false;
			}
		}
		return true;
	}
}
```

æ‰“å°ï¼š

```java
Connected to the target VM, address: '127.0.0.1:61863', transport: 'socket'
Trying to Mine block 1... 
Block Mined!!! : 0000016667d4240e9c30f53015310b0ec6ce99032d7e1d66d670afc509cab082
Trying to Mine block 2... 
Block Mined!!! : 000002ea55735bea4cac7e358c7b0d8d81e8ca24021f5f85211bf54fd4ac795a
Trying to Mine block 3... 
Block Mined!!! : 000000576987e5e9afbdf19b512b2b7d0c56db0e6ca49b3a7e638177f617994b

Blockchain is Valid: true
[
  {
    "hash": "0000016667d4240e9c30f53015310b0ec6ce99032d7e1d66d670afc509cab082",
    "previousHash": "0",
    "data": "first",
    "timeStamp": 1520659506042,
    "nonce": 618139
  },
  {
    "hash": "000002ea55735bea4cac7e358c7b0d8d81e8ca24021f5f85211bf54fd4ac795a",
    "previousHash": "0000016667d4240e9c30f53015310b0ec6ce99032d7e1d66d670afc509cab082",
    "data": "second",
    "timeStamp": 1520659508825,
    "nonce": 1819877
  },
  {
    "hash": "000000576987e5e9afbdf19b512b2b7d0c56db0e6ca49b3a7e638177f617994b",
    "previousHash": "000002ea55735bea4cac7e358c7b0d8d81e8ca24021f5f85211bf54fd4ac795a",
    "data": "third",
    "timeStamp": 1520659515910,
    "nonce": 1404341
  }
]
```

ç»è¿‡æµ‹è¯•å¢åŠ ä¸€ä¸ªæ–°çš„åŒºå—å³æŒ–çŸ¿å¿…é¡»èŠ±è´¹ä¸€å®šæ—¶é—´ï¼Œå¤§æ¦‚æ˜¯3ç§’å·¦å³ï¼Œä½ å¯ä»¥æé«˜difficultyéš¾åº¦æ¥çœ‹ï¼Œå®ƒæ˜¯å¦‚ä½•å½±å“æ•°æ®éš¾é¢˜æ‰€èŠ±è´¹çš„æ—¶é—´çš„

å¦‚æœæœ‰äººåœ¨ä½ çš„åŒºå—é“¾ç³»ç»Ÿä¸­æ¶æ„ç¯¡æ”¹æ•°æ®ï¼š

1. ä»–ä»¬çš„åŒºå—é“¾æ˜¯æ— æ•ˆçš„ã€‚
2. ä»–ä»¬æ— æ³•åˆ›å»ºæ›´é•¿çš„åŒºå—é“¾
3. ç½‘ç»œä¸­è¯šå®çš„åŒºå—é“¾ä¼šåœ¨é•¿é“¾ä¸­æ›´æœ‰æ—¶é—´çš„ä¼˜åŠ¿

å› ä¸ºç¯¡æ”¹çš„åŒºå—é“¾å°†æ— æ³•èµ¶ä¸Šé•¿é“¾å’Œæœ‰æ•ˆé“¾ï¼Œé™¤éä»–ä»¬æ¯”ä½ ç½‘ç»œä¸­æ‰€æœ‰çš„èŠ‚ç‚¹æ‹¥æœ‰æ›´å¤§çš„è®¡ç®—é€Ÿåº¦ï¼Œå¯èƒ½æ˜¯æœªæ¥çš„é‡å­è®¡ç®—æœºæˆ–è€…æ˜¯å…¶ä»–ä»€ä¹ˆã€‚

### ä½ å·²ç»å®Œæˆäº†ä½ çš„åŸºæœ¬åŒºå—é“¾ï¼



[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif)

ä½ çš„åŒºå—é“¾ï¼š

- æœ‰å¾ˆå¤šåŒºå—ç»„æˆç”¨æ¥å­˜å‚¨æ•°æ®
- æœ‰æ•°å­—ç­¾åè®©ä½ çš„åŒºå—é“¾é“¾æ¥åœ¨ä¸€èµ·
- éœ€è¦æŒ–çŸ¿çš„å·¥ä½œé‡è¯æ˜æ–°çš„åŒºå—
- å¯ä»¥ç”¨æ¥æ£€æŸ¥æ•°æ®æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åŒæ—¶æ˜¯æœªç»ç¯¡æ”¹çš„

### **æ¥ä¸‹æ¥çš„ä»»åŠ¡**

- åˆ›å»ºä¸€ä¸ªç®€å•çš„é’±åŒ…ã€‚
- ä½¿ç”¨æˆ‘ä»¬çš„åŒºå—é“¾å‘é€å¸¦ç­¾åçš„äº¤æ˜“ã€‚
- æ„Ÿè§‰å¾ˆåŠ

**è¿™æ ·æˆ‘ä»¬å°±æœ‰è‡ªå·±çš„åŠ å¯†è´§å¸**

*å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œåˆ›å»ºçš„åŒºå—é“¾å¹¶ä¸æ˜¯åŠŸèƒ½å®Œå…¨çš„å®Œå…¨é€‚åˆåº”ç”¨ä¸ç”Ÿäº§çš„åŒºå—é“¾ï¼Œç›¸ååªæ˜¯ä¸ºäº†å¸®åŠ©ä½ æ›´å¥½çš„ç†è§£åŒºå—é“¾çš„æ¦‚å¿µã€‚*

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai05.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai05.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai05.gif)

> åˆ«æ‹…å¿ƒï¼Œè¿™å®é™…ä¸Šæ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ¯”ä¸Šä¸€ä¸ªæ•™ç¨‹è¦é•¿!

æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„åŒºå—é“¾ï¼Œä½†åœ¨åŒºå—é“¾ä¸­å­˜æ”¾çš„æ˜¯ä¸€äº›æ— ç”¨çš„ä¿¡æ¯ã€‚ä»Šå¤©æˆ‘ä»¬å°†ç”¨äº¤æ˜“å–ä»£è¿™äº›ä¿¡æ¯ï¼ˆæˆ‘ä»¬çš„åŒºå—å°†èƒ½å¤Ÿä¿å­˜å¤šä¸ªäº¤æ˜“ï¼‰ï¼Œå…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªéå¸¸ç®€å•çš„åŠ å¯†è´§å¸,æˆ‘ä»¬çš„è´§å¸åå­—`NoobCoin`ã€‚

- å¯¼å…¥[ bounceycastle](https://www.bouncycastle.org/latest_releases.html)å’Œ`GSON`

### å‡†å¤‡ä¸€ä¸ªé’±åŒ…

åœ¨åŠ å¯†è´§å¸ä¸­ï¼Œåœ¨åŒºå—é“¾ä½œä¸ºäº¤æ˜“æ—¶ï¼Œè´§å¸æ‰€æœ‰æƒå¯ä»¥è¿›è¡Œè½¬ç§»ï¼Œæ¯ä¸ªå‚ä¸è€…éƒ½æœ‰ä¸€ä¸ªè‡ªå·±ç§æœ‰çš„åœ°å€æ¥å‘é€æˆ–è€…æ˜¯æ”¶å–è´§å¸ã€‚ï¼Œé’±åŒ…å¯ä»¥å­˜å‚¨è¿™äº›åœ°å€ã€‚å› æ­¤é’±åŒ…å°±æ˜¯å¯ä»¥åœ¨åŒºå—é“¾ä¸Šè¿›è¡Œæ–°äº¤æ˜“çš„è½¯ä»¶ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png)

> Donâ€™t worry about the information on the transaction, that will be explained soon

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé’±åŒ…ç±»æ¥ä¿å­˜å…¬é’¥å’Œç§é’¥:

```java
package noobchain;
import java.security.*;

public class Wallet {
	public PrivateKey privateKey;
	public PublicKey publicKey;
}
```

å…¬é’¥å’Œç§é’¥ç©¶ç«Ÿæ˜¯èµ·åˆ°ä»€ä¹ˆä½œç”¨å‘¢ï¼Œå…¶å®å…¬é’¥çš„ä½œç”¨å°±æ˜¯åœ°å€ï¼Œä½ å¯ä»¥åˆ†äº«ä½ çš„å…¬é’¥ç»™åˆ«äººä»¥æ­¤æ¥è·å–ä»˜æ¬¾ï¼Œè€Œä½ çš„ç§é’¥çš„ä½œç”¨æ˜¯ä¸ºäº†å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œè¿™æ ·å…¶ä»–äººå°±ä¸å¯ä»¥èŠ±è´¹ä½ çš„é‡‘é¢é™¤éå®ƒæ‹¥æœ‰ä½ çš„ç§é’¥ï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªäººè€Œè¨€æˆ‘ä»¬å¿…é¡»ä¿æŠ¤å¥½æˆ‘ä»¬çš„ç§é’¥ï¼Œä¸èƒ½é€éœ²æˆ‘ä»¬çš„ç§é’¥ä¿¡æ¯ç»™å…¶ä»–äººã€‚åŒæ—¶åœ¨æˆ‘ä»¬è¿›è¡Œäº¤æ˜“çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿä¼šåŒæ—¶å‘é€æˆ‘ä»¬çš„å…¬é’¥ç”±æ­¤æ¥éªŒè¯æˆ‘ä»¬çš„ç­¾åæ˜¯æœ‰æ•ˆçš„è€Œä¸”æ²¡æœ‰æ•°æ®è¢«ç¯¡æ”¹ã€‚

æˆ‘ä»¬åœ¨å¯†é’¥å¯¹`KeyPair`ç”Ÿæˆç§æœ‰å’Œå…¬é’¥ã€‚æˆ‘ä»¬å°†ä½¿ç”¨[æ¤­åœ†æ›²çº¿åŠ å¯†](https://en.wikipedia.org/wiki/Elliptic-curve_cryptography)æ¥ç”Ÿæˆæˆ‘ä»¬çš„å¯†é’¥å¯¹`KeyPair`ã€‚è®©æˆ‘ä»¬å°†`generateKeyPair()`æ–¹æ³•æ·»åŠ åˆ°æˆ‘ä»¬çš„é’±åŒ…ç±»ä¸­ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨å®ƒ:

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai02.png)

> ç§é’¥ç”¨äºç­¾ç½²æˆ‘ä»¬ä¸æƒ³è¢«ç¯¡æ”¹çš„æ•°æ®ã€‚å…¬é’¥ç”¨äºéªŒè¯ç­¾åã€‚

```java
package noobchain;
import java.security.*;

public class Wallet {
	
	public PrivateKey privateKey;
	public PublicKey publicKey;
	
	public Wallet(){
		generateKeyPair();	
	}
		
	public void generateKeyPair() {
		try {
			KeyPairGenerator keyGen = KeyPairGenerator.getInstance("ECDSA","BC");
			SecureRandom random = SecureRandom.getInstance("SHA1PRNG");
			ECGenParameterSpec ecSpec = new ECGenParameterSpec("prime192v1");
			// Initialize the key generator and generate a KeyPair
			keyGen.initialize(ecSpec, random);   //256 bytes provides an acceptable security level
	        	KeyPair keyPair = keyGen.generateKeyPair();
	        	// Set the public and private keys from the keyPair
	        	privateKey = keyPair.getPrivate();
	        	publicKey = keyPair.getPublic();
		}catch(Exception e) {
			throw new RuntimeException(e);
		}
	}
	
}
```

> ä½ ä¸éœ€è¦å®Œå…¨ç†è§£æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•çš„æ ¸å¿ƒé€»è¾‘ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Œä½ åªéœ€è¦å®ƒæ˜¯ç”¨æ¥åˆ›å»ºå…¬é’¥å’Œç§é’¥ï¼Œä»¥åŠå…¬é’¥å’Œç§é’¥åˆ†åˆ«æ‰€èµ·åˆ°çš„ä½œç”¨æ˜¯ä»€ä¹ˆå°±å¯ä»¥äº†ã€‚

ç°åœ¨æˆ‘ä»¬å·²ç»åˆäº†é’±åŒ…ç±»çš„å¤§æ¦‚æ¡†æ¶ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹äº¤æ˜“ç±»ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai06.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai06.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai06.gif)

### äº¤æ˜“å’Œæ•°å­—ç­¾å

æ¯ç¬”äº¤æ˜“å°†æºå¸¦ä¸€å®šä»¥ä¸‹ä¿¡æ¯ï¼š

1. èµ„é‡‘ä»˜æ¬¾äººçš„å…¬åŒ™ä¿¡æ¯ã€‚
2. èµ„é‡‘æ”¶æ¬¾äººçš„å…¬åŒ™ä¿¡æ¯ã€‚
3. è¢«è½¬ç§»èµ„é‡‘çš„é‡‘é¢ã€‚
4. è¾“å…¥ï¼Œå®ƒæ˜¯å¯¹ä»¥å‰çš„äº¤æ˜“çš„å¼•ç”¨ï¼Œè¯æ˜å‘é€è€…æœ‰èµ„é‡‘å‘é€ã€‚
5. è¾“å‡ºï¼Œæ˜¾ç¤ºäº¤æ˜“ä¸­æ”¶æ¬¾æ–¹ç›¸å…³åœ°å€æ•°é‡ã€‚(è¿™äº›è¾“å‡ºè¢«å¼•ç”¨ä¸ºæ–°äº¤æ˜“çš„è¾“å…¥)
6. ä¸€ä¸ªåŠ å¯†ç­¾åï¼Œè¯æ˜è¯¥äº¤æ˜“æ˜¯ç”±åœ°å€çš„å‘é€è€…æ˜¯å‘é€çš„ï¼Œå¹¶ä¸”æ•°æ®æ²¡æœ‰è¢«æ›´æ”¹ã€‚(é˜»æ­¢ç¬¬ä¸‰æ–¹æœºæ„æ›´æ”¹å‘é€çš„æ•°é‡)

è®©æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªæ–°çš„äº¤æ˜“ç±»ï¼š

```java
import java.security.*;
import java.util.ArrayList;

public class Transaction {
	
	public String transactionId; // this is also the hash of the transaction.
	public PublicKey sender; // senders address/public key.
	public PublicKey reciepient; // Recipients address/public key.
	public float value;
	public byte[] signature; // this is to prevent anybody else from spending funds in our wallet.
	
	public ArrayList<TransactionInput> inputs = new ArrayList<TransactionInput>();
	public ArrayList<TransactionOutput> outputs = new ArrayList<TransactionOutput>();
	
	private static int sequence = 0; // a rough count of how many transactions have been generated. 
	
	// Constructor: 
	public Transaction(PublicKey from, PublicKey to, float value,  ArrayList<TransactionInput> inputs) {
		this.sender = from;
		this.reciepient = to;
		this.value = value;
		this.inputs = inputs;
	}
	
	// This Calculates the transaction hash (which will be used as its Id)
	private String calulateHash() {
		sequence++; //increase the sequence to avoid 2 identical transactions having the same hash
		return StringUtil.applySha256(
				StringUtil.getStringFromKey(sender) +
				StringUtil.getStringFromKey(reciepient) +
				Float.toString(value) + sequence
				);
	}
}
```

æˆ‘ä»¬è¿˜åº”è¯¥åˆ›å»ºç©ºçš„`transactioninput`å’Œ`transactionoutput`ç±»ï¼Œä¸è¦æ‹…å¿ƒæˆ‘ä»¬å¯ä»¥åœ¨åé¢å¡«å†™å®ƒä»¬ã€‚

æˆ‘ä»¬çš„äº¤æ˜“ç±»è¿˜å°†åŒ…å«ç”Ÿæˆ/éªŒè¯ç­¾åå’ŒéªŒè¯äº¤æ˜“çš„ç›¸å…³æ–¹æ³•ï¼Œé‚£ä¹ˆç­¾åçš„æ„å›¾æ˜¯ä»€ä¹ˆï¼Ÿç­¾ååœ¨æˆ‘ä»¬çš„åŒºå—é“¾ä¸­æ‰§è¡Œäº†ä¸¤ä¸ªéå¸¸é‡è¦çš„ä»»åŠ¡ï¼šç¬¬ä¸€ï¼Œç­¾åç”¨æ¥ä¿è¯åªæœ‰è´§å¸çš„æ‹¥æœ‰è€…æ‰å¯ä»¥ç”¨æ¥å‘é€è‡ªå·±çš„è´§å¸ï¼Œç¬¬äºŒï¼Œç­¾åç”¨æ¥é˜»æ­¢å…¶ä»–äººè¯•å›¾ç¯¡æ”¹æäº¤çš„äº¤æ˜“ã€‚

**å³ç§é’¥è¢«ç”¨æ¥ç­¾åæ•°æ®ï¼Œè€Œå…¬é’¥ç”¨æ¥éªŒè¯å…¶å®Œæ•´æ€§ã€‚**

> ä¸¾ä¸ªä¾‹å­ï¼šBob æƒ³è¦å‘é€2ä¸ªåŠ å¯†è´§å¸ç»™Sallyï¼Œä»–ä»¬ç”¨å„è‡ªçš„é’±åŒ…åˆ›å»ºäº†äº¤æ˜“ï¼Œå¹¶æäº¤åˆ°å…¨ç½‘çš„åŒºå—é“¾ä¸­ä½œä¸ºä¸€ä¸ªæ–°çš„åŒºå—ï¼Œä¸€ä¸ªæŒ–çŸ¿è€…è¯•å›¾ç¯¡æ”¹æ¥å—è€…æŠŠ2ä¸ªåŠ å¯†è´§å¸ç»™Johnï¼Œä½†æ˜¯å¹¸è¿çš„äº‹ï¼ŒBobåœ¨äº¤æ˜“æ•°æ®ä¸­å·²ç»ç”¨ç§é’¥è¿›è¡Œäº†ç­¾åï¼Œè¿™å°±å…è®¸äº†å…¨ç½‘ä¸­çš„ä»»ä½•èŠ‚ç‚¹ä½¿ç”¨å°æ˜çš„å…¬åŒ™è¿›è¡ŒéªŒè¯æ•°æ®æ˜¯å¦å·²ç»è¢«ç¯¡æ”¹ï¼ˆå› ä¸ºæ²¡æœ‰å…¶ä»–äººçš„å…¬é’¥å¯ä»¥ç”¨æ¥éªŒè¯å°æ˜å‘å‡ºçš„è¿™ç¬”äº¤æ˜“ï¼‰ã€‚

ä»å‰é¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç­¾åå°†æ˜¯ä¸€å †å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–¹æ³•æ¥ç”Ÿæˆå®ƒä»¬ã€‚é¦–å…ˆæˆ‘ä»¬åœ¨`StringUtil`ç±»ä¸­åˆ›å»ºäº§ç”Ÿç­¾åçš„æ–¹æ³•ã€‚

```java
public static byte[] applyECDSASig(PrivateKey privateKey, String input) {
		Signature dsa;
		byte[] output = new byte[0];
		try {
			dsa = Signature.getInstance("ECDSA", "BC");
			dsa.initSign(privateKey);
			byte[] strByte = input.getBytes();
			dsa.update(strByte);
			byte[] realSig = dsa.sign();
			output = realSig;
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
		return output;
	}
	
	//Verifies a String signature 
	public static boolean verifyECDSASig(PublicKey publicKey, String data, byte[] signature) {
		try {
			Signature ecdsaVerify = Signature.getInstance("ECDSA", "BC");
			ecdsaVerify.initVerify(publicKey);
			ecdsaVerify.update(data.getBytes());
			return ecdsaVerify.verify(signature);
		}catch(Exception e) {
			throw new RuntimeException(e);
		}
	}

	public static String getStringFromKey(Key key) {
		return Base64.getEncoder().encodeToString(key.getEncoded());
	}
```

> ä¸ç”¨æ‹…å¿ƒä½ ä¸èƒ½ç†è§£è¿™äº›æ–¹æ³•çš„å†…å®¹ï¼Œä½ æ‰€éœ€è¦çŸ¥é“çš„å°±æ˜¯`applyECDSASig`æ–¹æ³•çš„è¾“å…¥å‚æ•°ä¸ºä»˜æ¬¾äººçš„ç§é’¥å’Œéœ€è¦åŠ å¯†çš„æ•°æ®ä¿¡æ¯ï¼Œç­¾ååè¿”å›å­—èŠ‚æ•°ç»„ã€‚è€Œ`verifyECDSASig`æ–¹æ³•çš„è¾“å…¥å‚æ•°ä¸ºå…¬é’¥ã€åŠ å¯†çš„æ•°æ®å’Œç­¾åï¼Œè°ƒç”¨è¯¥æ–¹æ³•åè¿”å›trueæˆ–falseæ¥è¯´æ˜ç­¾åæ˜¯å¦æ˜¯æœ‰æ•ˆçš„ã€‚`getStringFromKey`è¿”å›ä»»ä½•`key`çš„ç¼–ç å­—ç¬¦ä¸²

è®©æˆ‘ä»¬ä½¿ç”¨ç­¾åçš„æ–¹æ³•åœ¨äº¤æ˜“ç±»ä¸­ï¼Œå¢åŠ `generatesiganature()` å’Œ `varifiysignature()`æ–¹æ³•ï¼š

```java
//Signs all the data we dont wish to be tampered with.
public void generateSignature(PrivateKey privateKey) {
	String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value)	;
	signature = StringUtil.applyECDSASig(privateKey,data);		
}
//Verifies the data we signed hasnt been tampered with
public boolean verifiySignature() {
	String data = StringUtil.getStringFromKey(sender) + StringUtil.getStringFromKey(reciepient) + Float.toString(value)	;
	return StringUtil.verifyECDSASig(sender, data, signature);
}
```

> åœ¨ç°å®ä¸­ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ç­¾åæ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚ä½¿ç”¨çš„è¾“å‡º/è¾“å…¥å’Œ/æˆ–æ—¶é—´æˆ³ï¼ˆç°åœ¨æˆ‘ä»¬åªæ˜¯ç­¾åæœ€ä½é™åº¦çš„ä¿¡æ¯ï¼‰

ç­¾åå°†ç”±çŸ¿å·¥éªŒè¯ï¼Œåªæœ‰ç­¾åéªŒè¯æˆåŠŸåäº¤æ˜“æ‰èƒ½è¢«æ·»åŠ åˆ°åŒºå—ä¸­å»ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai07.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai07.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai07.gif)

> å½“æˆ‘ä»¬æ£€æŸ¥åŒºå—é“¾çš„æœ‰æ•ˆæ€§æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ£€æŸ¥ç­¾å

### æµ‹è¯•é’±åŒ…å’Œç­¾å

ç°åœ¨æˆ‘ä»¬ç®€å•çš„è¿›è¡Œä¸€äº›æµ‹è¯•ï¼Œåœ¨ä¸»æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¢åŠ äº†ä¸€äº›æ–°çš„å˜é‡ä¹Ÿæ›¿æ¢äº†æˆ‘ä»¬ä¹‹å‰åœ¨ä¸»æ–¹æ³•ä¸­çš„ä¸€äº›å†…å®¹ã€‚

```java
import java.security.Security;
import java.util.ArrayList;
import java.util.Base64;
import com.google.gson.GsonBuilder;

public class NoobChain {
	
	public static ArrayList<Block> blockchain = new ArrayList<Block>();
	public static int difficulty = 5;
	public static Wallet walletA;
	public static Wallet walletB;

	public static void main(String[] args) {	
		//Setup Bouncey castle as a Security Provider
		Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); 
		//Create the new wallets
		walletA = new Wallet();
		walletB = new Wallet();
		//Test public and private keys
		System.out.println("Private and public keys:");
		System.out.println(StringUtil.getStringFromKey(walletA.privateKey));
		System.out.println(StringUtil.getStringFromKey(walletA.publicKey));
		//Create a test transaction from WalletA to walletB 
		Transaction transaction = new Transaction(walletA.publicKey, walletB.publicKey, 5, null);
		transaction.generateSignature(walletA.privateKey);
		//Verify the signature works and verify it from the public key
		System.out.println("Is signature verified");
		System.out.println(transaction.verifiySignature());
		
	}
```

> ç¡®å®šè¦æ·»åŠ `bounceycastle`ä¾èµ–

æˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªé’±åŒ…walletaå’Œwalletbï¼Œç„¶åæ‰“å°äº†walletaçš„ç§é’¥å’Œå…¬é’¥ã€‚ç”Ÿæˆä¸€ä¸ªäº¤æ˜“å¹¶ä½¿ç”¨walletaçš„ç§é’¥å¯¹å…¶è¿›è¡Œç­¾åã€‚

æ‰“å°

```java
Connected to the target VM, address: '127.0.0.1:55757', transport: 'socket'
Private and public keys:
MHsCAQAwEwYHKoZIzj0CAQYIKoZIzj0DAQEEYTBfAgEBBBiJzZiesBnBWwwB+uog+fJX84mx4lPUTUagCgYIKoZIzj0DAQGhNAMyAAQfPzad0zqBUGQAany2rRZE1+2ml5IOCZST8LywjBQT8ux+3UPVbr2u0+LaExxz1WI=
MEkwEwYHKoZIzj0CAQYIKoZIzj0DAQEDMgAEHz82ndM6gVBkAGp8tq0WRNftppeSDgmUk/C8sIwUE/Lsft1D1W69rtPi2hMcc9Vi
Is signature verified
true
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºå¹¶éªŒè¯è¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶æŠŠäº¤æ˜“ä¿å­˜åˆ°åŒºå—é“¾ä¸­å»ã€‚

### è¾“å…¥å’Œè¾“å‡º 1ï¼šå¦‚ä½•éªŒè¯è´§å¸æ˜¯ä½ çš„

å¦‚æœä½ æ‹¥æœ‰1æ¯”ç‰¹å¸ï¼Œä½ å¿…é¡»å‰é¢å°±å¾—æ¥æ”¶1æ¯”ç‰¹å¸ã€‚æ¯”ç‰¹å¸çš„è´¦æœ¬ä¸ä¼šåœ¨ä½ çš„è´¦æˆ·ä¸­å¢åŠ ä¸€ä¸ªæ¯”ç‰¹å¸ä¹Ÿä¸ä¼šä»å‘é€è€…é‚£é‡Œå‡å»ä¸€ä¸ªæ¯”ç‰¹å¸ï¼Œå‘é€è€…åªèƒ½æŒ‡å‘ä»–/å¥¹ä¹‹å‰æ”¶åˆ°è¿‡ä¸€ä¸ªæ¯”ç‰¹å¸ï¼Œæ‰€ä»¥ä¸€ä¸ªäº¤æ˜“è¾“å‡ºè¢«åˆ›å»ºç”¨æ¥æ˜¾ç¤ºä¸€ä¸ªæ¯”ç‰¹å¸å‘é€ç»™ä½ çš„åœ°å€ï¼ˆäº¤æ˜“çš„è¾“å…¥æŒ‡å‘å‰ä¸€ä¸ªäº¤æ˜“çš„è¾“å‡ºï¼‰ã€‚

**ä½ çš„é’±åŒ…ä½™é¢æ˜¯æ‰€æœ‰æœªä½¿ç”¨çš„äº¤æ˜“è¾“å‡ºçš„æ€»å’Œ**

ä»è¿™ä¸€ä¸ªç‚¹å‡ºå‘ï¼Œæˆ‘ä»¬ä¼šä¾ç…§æ¯”ç‰¹å¸ä¸­çš„è¯´æ˜ï¼ŒæŠŠæ‰€æœ‰æœªä½¿ç”¨çš„äº¤æ˜“è¾“å‡ºç§°ä¸º[UTXO](http://8btc.com/article-4381-1.html).

åˆ›å»º`TransactionInput` ç±»ï¼š

```java
public class TransactionInput {
	public String transactionOutputId; //Reference to TransactionOutputs -> transactionId
	public TransactionOutput UTXO; //Contains the Unspent transaction output
	
	public TransactionInput(String transactionOutputId) {
		this.transactionOutputId = transactionOutputId;
	}
}
```

> è¿™ä¸ªç±»å°†ç”¨äºå¼•ç”¨å°šæœªä½¿ç”¨çš„`transactionoutput`ã€‚`transactionOutputId`å°†ç”¨äºæŸ¥æ‰¾ç›¸å…³çš„`TransactionOutput`ï¼Œå…è®¸çŸ¿å·¥æ£€æŸ¥æ‚¨çš„æ‰€æœ‰æƒã€‚

åˆ›å»º`TransactionOutputs `ç±»ï¼š

```java
import java.security.PublicKey;

public class TransactionOutput {
	public String id;
	public PublicKey reciepient; //also known as the new owner of these coins.
	public float value; //the amount of coins they own
	public String parentTransactionId; //the id of the transaction this output was created in
	
	//Constructor
	public TransactionOutput(PublicKey reciepient, float value, String parentTransactionId) {
		this.reciepient = reciepient;
		this.value = value;
		this.parentTransactionId = parentTransactionId;
		this.id = StringUtil.applySha256(StringUtil.getStringFromKey(reciepient)+Float.toString(value)+parentTransactionId);
	}
	
	//Check if coin belongs to you
	public boolean isMine(PublicKey publicKey) {
		return (publicKey == reciepient);
	}
	
}
```

äº¤æ˜“è¾“å‡ºç±»å°†æ˜¾ç¤ºä»äº¤æ˜“ä¸­å‘é€ç»™æ¯ä¸€æ–¹çš„æœ€ç»ˆé‡‘é¢ã€‚è¿™äº›ä½œä¸ºæ–°äº¤æ˜“ä¸­çš„è¾“å…¥å‚è€ƒï¼Œä½œä¸ºè¯æ˜ä½ å¯ä»¥å‘é€çš„é‡‘é¢æ•°é‡ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai08.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai08.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai08.gif)

### è¾“å…¥å’Œè¾“å‡º 2ï¼šå¤„ç†äº¤æ˜“

åŒºå—é“¾å¯èƒ½ä¼šæ”¶åˆ°å¾ˆå¤šäº¤æ˜“ï¼Œè€ŒåŒºå—é“¾å¯èƒ½ä¼šéå¸¸é•¿ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»æŸ¥æ‰¾å¹¶æ£€æŸ¥å…¶è¾“å…¥ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦éå¸¸é•¿çš„æ—¶é—´æ¥å¤„ç†æ–°çš„äº¤æ˜“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¿å­˜äº†ä¸€ä¸ªé¢å¤–çš„é›†åˆç§°ä¹‹ä¸ºä¸ºä½¿ç”¨çš„äº¤æ˜“ä½œä¸ºå¯ç”¨çš„è¾“å…¥,æ‰€ä»¥åœ¨ä¸»å‡½æ•°ä¸­å¢åŠ ä¸€ä¸ªé›†åˆç§°ä¸ºUTXOã€‚

```java
public class NoobChain {
	
	public static ArrayList<Block> blockchain = new ArrayList<Block>();
	public static HashMap<String,TransactionOutputs> UTXOs = new HashMap<String,TransactionOutputs>(); //list of all unspent transactions. 
	public static int difficulty = 5;
	public static Wallet walletA;
	public static Wallet walletB;

	public static void main(String[] args) {	
```

> ```
> hashmap`å…è®¸æˆ‘ä»¬ä½¿ç”¨é”®æ¥æŸ¥æ‰¾å€¼ï¼Œä½†æ˜¯æ‚¨éœ€è¦å¯¼å…¥`java.util.hashmap
> ```

é‡ç‚¹æ¥äº†ï¼Œæˆ‘ä»¬åœ¨äº¤æ˜“ç±»ä¸­å¢åŠ ä¸€ä¸ª`processTransaction`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æŠŠä¸€åˆ‡æ”¾åœ¨ä¸€èµ·ç”¨æ¥å¤„ç†äº¤æ˜“ã€‚

```java
//Returns true if new transaction could be created.	
public boolean processTransaction() {
		
		if(verifiySignature() == false) {
			System.out.println("#Transaction Signature failed to verify");
			return false;
		}
				
		//gather transaction inputs (Make sure they are unspent):
		for(TransactionInput i : inputs) {
			i.UTXO = NoobChain.UTXOs.get(i.transactionOutputId);
		}

		//check if transaction is valid:
		if(getInputsValue() < NoobChain.minimumTransaction) {
			System.out.println("#Transaction Inputs to small: " + getInputsValue());
			return false;
		}
		
		//generate transaction outputs:
		float leftOver = getInputsValue() - value; //get value of inputs then the left over change:
		transactionId = calulateHash();
		outputs.add(new TransactionOutput( this.reciepient, value,transactionId)); //send value to recipient
		outputs.add(new TransactionOutput( this.sender, leftOver,transactionId)); //send the left over 'change' back to sender		
				
		//add outputs to Unspent list
		for(TransactionOutput o : outputs) {
			NoobChain.UTXOs.put(o.id , o);
		}
		
		//remove transaction inputs from UTXO lists as spent:
		for(TransactionInput i : inputs) {
			if(i.UTXO == null) continue; //if Transaction can't be found skip it 
			NoobChain.UTXOs.remove(i.UTXO.id);
		}
		
		return true;
	}
	
//returns sum of inputs(UTXOs) values
	public float getInputsValue() {
		float total = 0;
		for(TransactionInput i : inputs) {
			if(i.UTXO == null) continue; //if Transaction can't be found skip it 
			total += i.UTXO.value;
		}
		return total;
	}

//returns sum of outputs:
	public float getOutputsValue() {
		float total = 0;
		for(TransactionOutput o : outputs) {
			total += o.value;
		}
		return total;
	}
```

> æˆ‘ä»¬è¿˜æ·»åŠ äº†`getinputsvalue`æ–¹æ³•

é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬æ‰§è¡Œä¸€äº›æ£€æŸ¥ä»¥ç¡®ä¿äº¤æ˜“æœ‰æ•ˆï¼Œç„¶åæ”¶é›†è¾“å…¥å¹¶ç”Ÿæˆè¾“å‡ºã€‚æœ€é‡è¦çš„æ˜¯ï¼Œæœ€åï¼Œæˆ‘ä»¬æŠ›å¼ƒäº†è¾“å…¥åœ¨æˆ‘ä»¬çš„UTXOåˆ—è¡¨ï¼Œè¿™å°±æ„å‘³ç€ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„äº¤æ˜“è¾“å‡ºå¿…é¡»ä¹‹å‰ä¸€å®šæ˜¯è¾“å…¥ï¼Œæ‰€ä»¥è¾“å…¥çš„å€¼å¿…é¡»è¢«å®Œå…¨ä½¿ç”¨ï¼Œæ‰€ä»¥ä»˜æ¬¾äººå¿…é¡»æ”¹å˜å®ƒä»¬è‡ªèº«çš„é‡‘é¢çŠ¶æ€ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai04.png)

> çº¢è‰²ç®­å¤´æ˜¯è¾“å‡ºã€‚è¯·æ³¨æ„ï¼Œç»¿è‰²è¾“å…¥æ˜¯å¯¹ä¹‹å‰è¾“å‡ºçš„å‚è€ƒ

æœ€åè®©æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„walletç±»

- æœé›†ä½™é¢ï¼ˆé€šè¿‡å¾ªç¯éå†UTXOåˆ—è¡¨æ¥æ£€æŸ¥äº¤æ˜“çš„è¾“å‡ºæ˜¯å¦æ˜¯æˆ‘çš„ï¼‰å¹¶
- åˆ›å»ºäº¤æ˜“

```java
import java.security.*;
import java.security.spec.ECGenParameterSpec;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

public class Wallet {
	
	public PrivateKey privateKey;
	public PublicKey publicKey;
	
	public HashMap<String,TransactionOutput> UTXOs = new HashMap<String,TransactionOutput>(); //only UTXOs owned by this wallet.
	
	public Wallet() {...
		
	public void generateKeyPair() {...
	
  //returns balance and stores the UTXO's owned by this wallet in this.UTXOs
	public float getBalance() {
		float total = 0;	
        for (Map.Entry<String, TransactionOutput> item: NoobChain.UTXOs.entrySet()){
        	TransactionOutput UTXO = item.getValue();
            if(UTXO.isMine(publicKey)) { //if output belongs to me ( if coins belong to me )
            	UTXOs.put(UTXO.id,UTXO); //add it to our list of unspent transactions.
            	total += UTXO.value ; 
            }
        }  
		return total;
	}
	//Generates and returns a new transaction from this wallet.
	public Transaction sendFunds(PublicKey _recipient,float value ) {
		if(getBalance() < value) { //gather balance and check funds.
			System.out.println("#Not Enough funds to send transaction. Transaction Discarded.");
			return null;
		}
    //create array list of inputs
		ArrayList<TransactionInput> inputs = new ArrayList<TransactionInput>();
    
		float total = 0;
		for (Map.Entry<String, TransactionOutput> item: UTXOs.entrySet()){
			TransactionOutput UTXO = item.getValue();
			total += UTXO.value;
			inputs.add(new TransactionInput(UTXO.id));
			if(total > value) break;
		}
		
		Transaction newTransaction = new Transaction(publicKey, _recipient , value, inputs);
		newTransaction.generateSignature(privateKey);
		
		for(TransactionInput input: inputs){
			UTXOs.remove(input.transactionOutputId);
		}
		return newTransaction;
	}
	
}
```

> ä½ å¯ä»¥éšæ—¶ä¸ºé’±åŒ…æ·»åŠ ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚è®°å½•æ‚¨çš„äº¤æ˜“å†å²è®°å½•ã€‚

### æ·»åŠ äº¤æ˜“åˆ°åŒºå—ä¸­

ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªæœ‰æ•ˆçš„äº¤æ˜“ç³»ç»Ÿï¼Œæˆ‘ä»¬éœ€è¦æŠŠäº¤æ˜“åŠ å…¥åˆ°æˆ‘ä»¬çš„åŒºå—é“¾ä¸­ã€‚æˆ‘ä»¬æŠŠäº¤æ˜“åˆ—è¡¨æ›¿æ¢æˆ‘ä»¬å—ä¸­æ— ç”¨çš„æ•°æ®ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªå•ä¸€çš„åŒºå—ä¸­å¯èƒ½å­˜æ”¾äº†1000ä¸ªäº¤æ˜“ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡çš„hashè®¡ç®—ï¼Œä¸ç”¨æ‹…å¿ƒåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†äº¤æ˜“çš„`merkle root`ï¼Œç¨åä½ ä¼šçœ‹åˆ°ã€‚è®©æˆ‘ä»¬å¢åŠ ä¸€ä¸ªå¸®åŠ©æ–¹æ³•æ¥åˆ›å»º`merkle root`åœ¨`StringUtils`ç±»ä¸­ã€‚

åœ¨`StringUtils`ç±»ä¸­åˆ›å»º`getMerkleRoot`æ–¹æ³•

```java
//Tacks in array of transactions and returns a merkle root.
public static String getMerkleRoot(ArrayList<Transaction> transactions) {
		int count = transactions.size();
		ArrayList<String> previousTreeLayer = new ArrayList<String>();
		for(Transaction transaction : transactions) {
			previousTreeLayer.add(transaction.transactionId);
		}
		ArrayList<String> treeLayer = previousTreeLayer;
		while(count > 1) {
			treeLayer = new ArrayList<String>();
			for(int i=1; i < previousTreeLayer.size(); i++) {
				treeLayer.add(applySha256(previousTreeLayer.get(i-1) + previousTreeLayer.get(i)));
			}
			count = treeLayer.size();
			previousTreeLayer = treeLayer;
		}
		String merkleRoot = (treeLayer.size() == 1) ? treeLayer.get(0) : "";
		return merkleRoot;
	}
```

> æˆ‘ä¼šå°½å¿«ç”¨ä¸€ä¸ªå®é™…çš„merklerootå–ä»£è¿™ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ç°åœ¨ä½¿ç”¨è¿™ä¸ªå¯ä»¥æ­£å¸¸è¿è¡Œ

ä¿®æ¥`Block` ç±»

```java
import java.util.ArrayList;
import java.util.Date;

public class Block {
	
	public String hash;
	public String previousHash; 
	public String merkleRoot;
	public ArrayList<Transaction> transactions = new ArrayList<Transaction>(); //our data will be a simple message.
	public long timeStamp; //as number of milliseconds since 1/1/1970.
	public int nonce;
	
	//Block Constructor.  
	public Block(String previousHash ) {
		this.previousHash = previousHash;
		this.timeStamp = new Date().getTime();
		
		this.hash = calculateHash(); //Making sure we do this after we set the other values.
	}
	
	//Calculate new hash based on blocks contents
	public String calculateHash() {
		String calculatedhash = StringUtil.applySha256( 
				previousHash +
				Long.toString(timeStamp) +
				Integer.toString(nonce) + 
				merkleRoot
				);
		return calculatedhash;
	}
	
	//Increases nonce value until hash target is reached.
	public void mineBlock(int difficulty) {
		merkleRoot = StringUtil.getMerkleRoot(transactions);
		String target = StringUtil.getDificultyString(difficulty); //Create a string with difficulty * "0" 
		while(!hash.substring( 0, difficulty).equals(target)) {
			nonce ++;
			hash = calculateHash();
		}
		System.out.println("Block Mined!!! : " + hash);
	}
	
	//Add transactions to this block
	public boolean addTransaction(Transaction transaction) {
		//process transaction and check if valid, unless block is genesis block then ignore.
		if(transaction == null) return false;		
		if((previousHash != "0")) {
			if((transaction.processTransaction() != true)) {
				System.out.println("Transaction failed to process. Discarded.");
				return false;
			}
		}
		transactions.add(transaction);
		System.out.println("Transaction Successfully added to Block");
		return true;
	}
	
}
```

éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬è¿˜æ›´æ–°äº†`Block`æ„é€ å‡½æ•°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦ä¼ é€’å­—ç¬¦ä¸²æ•°æ®ï¼Œå¹¶å°†`merkle root`åŒ…å«åœ¨è®¡ç®—å“ˆå¸Œæ–¹æ³•ä¸­ã€‚`addTransaction`æ–¹æ³•ç”¨æ¥å¢åŠ äº¤æ˜“ï¼Œåªæœ‰æ»¡è¶³æ¡ä»¶ä¸‹æ‰å¯ä»¥æˆåŠŸçš„åœ¨åŒºå—ä¸­å¢åŠ äº¤æ˜“ã€‚

æˆ‘ä»¬å·²ç»å®ç°äº†ä¸€ä¸ªå¯äº¤æ˜“çš„åŒºå—é“¾ã€‚

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai09.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai09.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai09.gif)

### æœ€åçš„æµ‹è¯•

æˆ‘ä»¬åº”è¯¥æµ‹è¯•ä»é’±åŒ…å‘é€è´§å¸ï¼Œæ›´æ–°åŒºå—é“¾å¹¶è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥ã€‚ä½†é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ç§å°†æ–°ç¡¬å¸å¼•å…¥æ··åˆçš„æ–¹æ³•ã€‚æœ‰å¾ˆå¤šæ–¹æ³•æ¥åˆ›å»ºæ–°çš„ç¡¬å¸ã€‚åœ¨æ¯”ç‰¹å¸åŒºå—é“¾ä¸Šï¼Œæœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åˆ›é€ æ–°çš„æ¯”ç‰¹å¸:çŸ¿å·¥å¯ä»¥å°†äº¤æ˜“åŒ…æ‹¬åœ¨å†…ï¼Œä½œä¸ºå¯¹æ¯ä¸ªçŸ¿å·¥æŒ–çŸ¿çš„å¥–åŠ±ã€‚ä½†åœ¨è¿™é‡Œæˆ‘ä»¬åªå¸Œæœ›åœ¨åˆ›ä¸–çºªåŒºå—ä¸­é‡Šæ”¾è´§å¸ã€‚å°±åƒæ¯”ç‰¹å¸ä¸­ä¸€ä¸‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹æˆ‘ä»¬çš„ä¸»å‡½æ•°ä»¥è¾¾åˆ°ä¸‹é¢çš„ç›®çš„ã€‚

1. åˆ›ä¸–çºªåŒºå—å‘å¸ƒ100ä¸ªè´§å¸ç»™walletA
2. ä¸€ä¸ªæ›´æ–°çš„é“¾æœ‰æ•ˆæ€§æ£€æŸ¥ï¼Œè€ƒè™‘åˆ°äº¤æ˜“ã€‚
3. æµ‹è¯•äº¤æ˜“çœ‹æ˜¯å¦ä¸€åˆ‡æ­£å¸¸ã€‚

```java
public class NoobChain {
	
	public static ArrayList<Block> blockchain = new ArrayList<Block>();
	public static HashMap<String,TransactionOutput> UTXOs = new HashMap<String,TransactionOutput>();
	
	public static int difficulty = 3;
	public static float minimumTransaction = 0.1f;
	public static Wallet walletA;
	public static Wallet walletB;
	public static Transaction genesisTransaction;

	public static void main(String[] args) {	
		//add our blocks to the blockchain ArrayList:
		Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider()); //Setup Bouncey castle as a Security Provider
		
		//Create wallets:
		walletA = new Wallet();
		walletB = new Wallet();		
		Wallet coinbase = new Wallet();
		
		//create genesis transaction, which sends 100 NoobCoin to walletA: 
		genesisTransaction = new Transaction(coinbase.publicKey, walletA.publicKey, 100f, null);
		genesisTransaction.generateSignature(coinbase.privateKey);	 //manually sign the genesis transaction	
		genesisTransaction.transactionId = "0"; //manually set the transaction id
		genesisTransaction.outputs.add(new TransactionOutput(genesisTransaction.reciepient, genesisTransaction.value, genesisTransaction.transactionId)); //manually add the Transactions Output
		UTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0)); //its important to store our first transaction in the UTXOs list.
		
		System.out.println("Creating and Mining Genesis block... ");
		Block genesis = new Block("0");
		genesis.addTransaction(genesisTransaction);
		addBlock(genesis);
		
		//testing
		Block block1 = new Block(genesis.hash);
		System.out.println("\nWalletA's balance is: " + walletA.getBalance());
		System.out.println("\nWalletA is Attempting to send funds (40) to WalletB...");
		block1.addTransaction(walletA.sendFunds(walletB.publicKey, 40f));
		addBlock(block1);
		System.out.println("\nWalletA's balance is: " + walletA.getBalance());
		System.out.println("WalletB's balance is: " + walletB.getBalance());
		
		Block block2 = new Block(block1.hash);
		System.out.println("\nWalletA Attempting to send more funds (1000) than it has...");
		block2.addTransaction(walletA.sendFunds(walletB.publicKey, 1000f));
		addBlock(block2);
		System.out.println("\nWalletA's balance is: " + walletA.getBalance());
		System.out.println("WalletB's balance is: " + walletB.getBalance());
		
		Block block3 = new Block(block2.hash);
		System.out.println("\nWalletB is Attempting to send funds (20) to WalletA...");
		block3.addTransaction(walletB.sendFunds( walletA.publicKey, 20));
		System.out.println("\nWalletA's balance is: " + walletA.getBalance());
		System.out.println("WalletB's balance is: " + walletB.getBalance());
		
		isChainValid();
		
	}
	
	public static Boolean isChainValid() {
		Block currentBlock; 
		Block previousBlock;
		String hashTarget = new String(new char[difficulty]).replace('\0', '0');
		HashMap<String,TransactionOutput> tempUTXOs = new HashMap<String,TransactionOutput>(); //a temporary working list of unspent transactions at a given block state.
		tempUTXOs.put(genesisTransaction.outputs.get(0).id, genesisTransaction.outputs.get(0));
		
		//loop through blockchain to check hashes:
		for(int i=1; i < blockchain.size(); i++) {
			
			currentBlock = blockchain.get(i);
			previousBlock = blockchain.get(i-1);
			//compare registered hash and calculated hash:
			if(!currentBlock.hash.equals(currentBlock.calculateHash()) ){
				System.out.println("#Current Hashes not equal");
				return false;
			}
			//compare previous hash and registered previous hash
			if(!previousBlock.hash.equals(currentBlock.previousHash) ) {
				System.out.println("#Previous Hashes not equal");
				return false;
			}
			//check if hash is solved
			if(!currentBlock.hash.substring( 0, difficulty).equals(hashTarget)) {
				System.out.println("#This block hasn't been mined");
				return false;
			}
			
			//loop thru blockchains transactions:
			TransactionOutput tempOutput;
			for(int t=0; t <currentBlock.transactions.size(); t++) {
				Transaction currentTransaction = currentBlock.transactions.get(t);
				
				if(!currentTransaction.verifiySignature()) {
					System.out.println("#Signature on Transaction(" + t + ") is Invalid");
					return false; 
				}
				if(currentTransaction.getInputsValue() != currentTransaction.getOutputsValue()) {
					System.out.println("#Inputs are note equal to outputs on Transaction(" + t + ")");
					return false; 
				}
				
				for(TransactionInput input: currentTransaction.inputs) {	
					tempOutput = tempUTXOs.get(input.transactionOutputId);
					
					if(tempOutput == null) {
						System.out.println("#Referenced input on Transaction(" + t + ") is Missing");
						return false;
					}
					
					if(input.UTXO.value != tempOutput.value) {
						System.out.println("#Referenced input Transaction(" + t + ") value is Invalid");
						return false;
					}
					
					tempUTXOs.remove(input.transactionOutputId);
				}
				
				for(TransactionOutput output: currentTransaction.outputs) {
					tempUTXOs.put(output.id, output);
				}
				
				if( currentTransaction.outputs.get(0).reciepient != currentTransaction.reciepient) {
					System.out.println("#Transaction(" + t + ") output reciepient is not who it should be");
					return false;
				}
				if( currentTransaction.outputs.get(1).reciepient != currentTransaction.sender) {
					System.out.println("#Transaction(" + t + ") output 'change' is not sender.");
					return false;
				}
				
			}
			
		}
		System.out.println("Blockchain is valid");
		return true;
	}
	
	public static void addBlock(Block newBlock) {
		newBlock.mineBlock(difficulty);
		blockchain.add(newBlock);
	}
}
```

æ‰“å°ï¼š

```java
Connected to the target VM, address: '127.0.0.1:57085', transport: 'socket'
Creating and Mining Genesis block... 
Transaction Successfully added to Block
Block Mined!!! : 000b5a7ca6bf07639122cb31e884996895a482c281dd89c203824f1e93a661bf

WalletA's balance is: 100.0

WalletA is Attempting to send funds (40) to WalletB...
Transaction Successfully added to Block
Block Mined!!! : 000c7f814357abfea86ad1b38ec1dc3afed2afc9107f2bacc933d8136bf34df0

WalletA's balance is: 60.0
WalletB's balance is: 40.0

WalletA Attempting to send more funds (1000) than it has...
#Not Enough funds to send transaction. Transaction Discarded.
Block Mined!!! : 000b3822fb7985db438712816727d4bc382926a1c4654062aad4071d9b9fad98

WalletA's balance is: 60.0
WalletB's balance is: 40.0

WalletB is Attempting to send funds (20) to WalletA...
Transaction Successfully added to Block

WalletA's balance is: 80.0
WalletB's balance is: 20.0
Blockchain is valid
```

ç°åœ¨é’±åŒ…èƒ½å¤Ÿå®‰å…¨åœ°åœ¨æ‚¨çš„åŒºå—é“¾ä¸Šå‘é€é‡‘é¢ï¼Œåªè¦ä»–ä»¬æœ‰é‡‘é¢å‘é€ã€‚è¿™æ„å‘³ç€ä½ æœ‰ä½ è‡ªå·±çš„æœ¬åœ°åŠ å¯†è´§å¸

### å¯ä»¥è¿›è¡Œäº¤æ˜“çš„åŒºå—é“¾

[![https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif)](https://raw.githubusercontent.com/longfeizheng/longfeizheng.github.io/master/images/qukuai/qukuai03.gif)

ä½ å·²ç»æˆåŠŸåœ°åˆ›å»ºäº†è‡ªå·±çš„åŠ å¯†è´§å¸ã€‚ä½ çš„åŒºå—é“¾ï¼š

- å…è®¸ç”¨æˆ·åˆ›å»ºé’±åŒ…
- ä½¿ç”¨æ¤­åœ†æ›²çº¿åŠ å¯†æ–¹å¼ä¸ºé’±åŒ…æä¾›å…¬é’¥å’Œç§é’¥
- é€šè¿‡ä½¿ç”¨æ•°å­—ç­¾åç®—æ³•è¯æ˜æ‰€æœ‰æƒï¼Œç¡®ä¿èµ„é‡‘è½¬ç§»
- å…è®¸ç”¨æˆ·åœ¨åŒºå—é“¾ä¸Šè¿›è¡Œäº¤æ˜“

## TODO:

- [ ] ç†è®ºéƒ¨åˆ†:
  - [x] åŸºç¡€
  - [ ] æ·±å…¥
- [x] å®è·µéƒ¨åˆ†

## Reference

1. çŸ¥ä¹ï¼š[æ±ªä¹-LaiW3n](https://www.zhihu.com/question/37290469/answer/107612456)
